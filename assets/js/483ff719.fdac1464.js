"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8750],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>c});var l=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,l,a=function(e,n){if(null==e)return{};var t,l,a={},o=Object.keys(e);for(l=0;l<o.length;l++)t=o[l],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(l=0;l<o.length;l++)t=o[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=l.createContext({}),p=function(e){var n=l.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=p(e.components);return l.createElement(s.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},d=l.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=p(t),c=a,k=d["".concat(s,".").concat(c)]||d[c]||m[c]||o;return t?l.createElement(k,r(r({ref:n},u),{},{components:t})):l.createElement(k,r({ref:n},u))}));function c(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,r=new Array(o);r[0]=d;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,r[1]=i;for(var p=2;p<o;p++)r[p]=t[p];return l.createElement.apply(null,r)}return l.createElement.apply(null,t)}d.displayName="MDXCreateElement"},9942:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var l=t(7462),a=(t(7294),t(3905));const o={title:"5. webpack \u7f16\u8bd1\u6d41\u7a0b",sidebar_position:5},r=void 0,i={unversionedId:"webpackFlow",id:"webpackFlow",title:"5. webpack \u7f16\u8bd1\u6d41\u7a0b",description:"webpack \u7f16\u8bd1\u6d41\u7a0b",source:"@site/engineering/06-webpackFlow.md",sourceDirName:".",slug:"/webpackFlow",permalink:"/website/engineering/webpackFlow",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"5. webpack \u7f16\u8bd1\u6d41\u7a0b",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"5. AST\u8bed\u6cd5\u6811",permalink:"/website/engineering/ast"}},s={},p=[{value:"webpack \u7f16\u8bd1\u6d41\u7a0b",id:"webpack-\u7f16\u8bd1\u6d41\u7a0b",level:2},{value:"1.1entry",id:"11entry",level:3},{value:"1.2loader.js",id:"12loaderjs",level:3},{value:"1.3 plugin.js",id:"13-pluginjs",level:3},{value:"1.4 webpack.config.js",id:"14-webpackconfigjs",level:3},{value:"1.5debugger.js",id:"15debuggerjs",level:3},{value:"1.6 webpack.js",id:"16-webpackjs",level:3},{value:"1.7 Compiler",id:"17-compiler",level:3},{value:"1.8 Compilation",id:"18-compilation",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"1. \u6587\u4ef6\u4f5c\u7528",id:"1-\u6587\u4ef6\u4f5c\u7528",level:3},{value:"<strong>webpack.js \u6587\u4ef6</strong>",id:"webpackjs-\u6587\u4ef6",level:4},{value:"<strong>Compiler</strong>\u6587\u4ef6",id:"compiler\u6587\u4ef6",level:4},{value:"Compilation \u6587\u4ef6",id:"compilation-\u6587\u4ef6",level:4},{value:"2. \u6d41\u7a0b\u603b\u7ed3",id:"2-\u6d41\u7a0b\u603b\u7ed3",level:3},{value:"<strong>\u521d\u59cb\u5316\u53c2\u6570\uff1a</strong>",id:"\u521d\u59cb\u5316\u53c2\u6570",level:4},{value:"<strong>\u5f00\u59cb\u7f16\u8bd1</strong>",id:"\u5f00\u59cb\u7f16\u8bd1",level:4},{value:"<strong>\u7f16\u8bd1\u6a21\u5757</strong>",id:"\u7f16\u8bd1\u6a21\u5757",level:4},{value:"<strong>\u8f93\u51fa\u8d44\u6e90</strong>",id:"\u8f93\u51fa\u8d44\u6e90",level:4},{value:"\u751f\u6210 bundle \u6587\u4ef6",id:"\u751f\u6210-bundle-\u6587\u4ef6",level:4},{value:"\u5199\u5165\u6587\u4ef6",id:"\u5199\u5165\u6587\u4ef6",level:4}],u={toc:p};function m(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,l.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"webpack-\u7f16\u8bd1\u6d41\u7a0b"},"webpack \u7f16\u8bd1\u6d41\u7a0b"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u521d\u59cb\u5316\u53c2\u6570\uff1a\u4ece\u914d\u7f6e\u6587\u4ef6\u548c Shell \u8bed\u53e5\u4e2d\u8bfb\u53d6\u5e76\u5408\u5e76\u53c2\u6570,\u5f97\u51fa\u6700\u7ec8\u7684\u914d\u7f6e\u5bf9\u8c61"),(0,a.kt)("li",{parentName:"ol"},"\u7528\u4e0a\u4e00\u6b65\u5f97\u5230\u7684\u53c2\u6570\u521d\u59cb\u5316 Compiler \u5bf9\u8c61"),(0,a.kt)("li",{parentName:"ol"},"\u52a0\u8f7d\u6240\u6709\u914d\u7f6e\u7684\u63d2\u4ef6"),(0,a.kt)("li",{parentName:"ol"},"\u6267\u884c\u5bf9\u8c61\u7684 run \u65b9\u6cd5\u5f00\u59cb\u6267\u884c\u7f16\u8bd1"),(0,a.kt)("li",{parentName:"ol"},"\u6839\u636e\u914d\u7f6e\u4e2d\u7684",(0,a.kt)("inlineCode",{parentName:"li"},"entry"),"\u627e\u51fa\u5165\u53e3\u6587\u4ef6"),(0,a.kt)("li",{parentName:"ol"},"\u4ece\u5165\u53e3\u6587\u4ef6\u51fa\u53d1,\u8c03\u7528\u6240\u6709\u914d\u7f6e\u7684",(0,a.kt)("inlineCode",{parentName:"li"},"Loader"),"\u5bf9\u6a21\u5757\u8fdb\u884c\u7f16\u8bd1"),(0,a.kt)("li",{parentName:"ol"},"\u518d\u627e\u51fa\u8be5\u6a21\u5757\u4f9d\u8d56\u7684\u6a21\u5757\uff0c\u518d\u9012\u5f52\u672c\u6b65\u9aa4\u76f4\u5230\u6240\u6709\u5165\u53e3\u4f9d\u8d56\u7684\u6587\u4ef6\u90fd\u7ecf\u8fc7\u4e86\u672c\u6b65\u9aa4\u7684\u5904\u7406"),(0,a.kt)("li",{parentName:"ol"},"\u6839\u636e\u5165\u53e3\u548c\u6a21\u5757\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u7ec4\u88c5\u6210\u4e00\u4e2a\u4e2a\u5305\u542b\u591a\u4e2a\u6a21\u5757\u7684 Chunk"),(0,a.kt)("li",{parentName:"ol"},"\u518d\u628a\u6bcf\u4e2a Chunk \u8f6c\u6362\u6210\u4e00\u4e2a\u5355\u72ec\u7684\u6587\u4ef6\u52a0\u5165\u5230\u8f93\u51fa\u5217\u8868"),(0,a.kt)("li",{parentName:"ol"},"\u5728\u786e\u5b9a\u597d\u8f93\u51fa\u5185\u5bb9\u540e\uff0c\u6839\u636e\u914d\u7f6e\u786e\u5b9a\u8f93\u51fa\u7684\u8def\u5f84\u548c\u6587\u4ef6\u540d\uff0c\u628a\u6587\u4ef6\u5185\u5bb9\u5199\u5165\u5230\u6587\u4ef6\u7cfb\u7edf")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5728\u4ee5\u4e0a\u8fc7\u7a0b\u4e2d\uff0cWebpack \u4f1a\u5728\u7279\u5b9a\u7684\u65f6\u95f4\u70b9\u5e7f\u64ad\u51fa\u7279\u5b9a\u7684\u4e8b\u4ef6\uff0c\u63d2\u4ef6\u5728\u76d1\u542c\u5230\u611f\u5174\u8da3\u7684\u4e8b\u4ef6\u540e\u4f1a\u6267\u884c\u7279\u5b9a\u7684\u903b\u8f91\uff0c\u5e76\u4e14\u63d2\u4ef6\u53ef\u4ee5\u8c03\u7528 Webpack \u63d0\u4f9b\u7684 API \u6539\u53d8 Webpack \u7684\u8fd0\u884c\u7ed3\u679c")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/ghx9908/image-hosting/master/img/20230302105130.png",alt:null})),(0,a.kt)("h3",{id:"11entry"},"1.1entry"),(0,a.kt)("p",null,"src\\entry1.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'let title = require("./title")\nconsole.log("entry12", title)\n')),(0,a.kt)("p",null,"src\\entry2.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'let title = require("./title.js")\nconsole.log("entry2", title)\n')),(0,a.kt)("p",null,"src\\title.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'module.exports = "title"\n')),(0,a.kt)("h3",{id:"12loaderjs"},"1.2loader.js"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"loader \u7684\u672c\u8d28\u5c31\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4e00\u4e2a\u7528\u4e8e\u8f6c\u6362\u6216\u8005\u8bf4\u7ffb\u8bd1\u7684\u51fd\u6570")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u628a\u90a3\u4e9b webpack \u4e0d\u8ba4\u8bc6\u7684\u6a21\u5757 less sass baxx \u8f6c\u6362\u4e3a webpack \u80fd\u8ba4\u8bc6\u7684\u6a21\u5757 js json"))),(0,a.kt)("p",null,"loaders\\logger1-loader.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function loader1(source) {\n  //let name= 'entry1';\n  return source + \"//logger1\" //let name= 'entry1';//logger1\n}\nmodule.exports = loader1\n")),(0,a.kt)("p",null,"loaders\\logger2-loader.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function loader2(source) {\n  //let name= 'entry1';\n  return source + \"//logger2\" //let name= 'entry1';//logger2\n}\nmodule.exports = loader2\n")),(0,a.kt)("h3",{id:"13-pluginjs"},"1.3 plugin.js"),(0,a.kt)("p",null,"plugins\\done-plugin.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'class DonePlugin {\n  apply(compiler) {\n    compiler.hooks.done.tap("DonePlugin", () => {\n      console.log("done:\u7ed3\u675f\u7f16\u8bd1")\n    })\n  }\n}\nmodule.exports = DonePlugin\n')),(0,a.kt)("p",null,"plugins\\run1-plugin.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'class RunPlugin {\n  apply(compiler) {\n    //\u5728\u6b64\u63d2\u4ef6\u91cc\u53ef\u4ee5\u76d1\u542crun\u8fd9\u4e2a\u94a9\u5b50\n    compiler.hooks.run.tap("Run1Plugin", () => {\n      console.log("run1:\u5f00\u59cb\u7f16\u8bd1")\n    })\n  }\n}\nmodule.exports = RunPlugin\n')),(0,a.kt)("p",null,"plugins\\run2-plugin.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'class RunPlugin {\n  apply(compiler) {\n    compiler.hooks.run.tap("Run2Plugin", () => {\n      console.log("run2:\u5f00\u59cb\u7f16\u8bd1")\n    })\n  }\n}\nmodule.exports = RunPlugin\n')),(0,a.kt)("h3",{id:"14-webpackconfigjs"},"1.4 webpack.config.js"),(0,a.kt)("p",null,"webpack.config.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const path = require("path")\nconst Run1Plugin = require("./plugins/run1-plugin")\nconst Run2Plugin = require("./plugins/run2-plugin")\nconst DonePlugin = require("./plugins/done-plugin")\nmodule.exports = {\n  mode: "development",\n  devtool: false,\n  context: process.cwd,\n  entry: {\n    entry1: "./src/entry1.js",\n    entry2: "./src/entry2.js",\n  },\n  output: {\n    path: path.resolve(__dirname, "dist"),\n    filename: "[name].js",\n  },\n  resolve: {\n    extensions: [".js", ".jsx", ".tx", ".tsx"],\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        use: [\n          path.resolve(__dirname, "loaders/loader2.js"),\n          path.resolve(__dirname, "loaders/loader1.js"),\n        ],\n      },\n    ],\n  },\n  plugins: [new DonePlugin(), new Run2Plugin(), new Run1Plugin()],\n}\n')),(0,a.kt)("h3",{id:"15debuggerjs"},"1.5debugger.js"),(0,a.kt)("p",null,"debugger.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const fs = require("fs")\nconst webpack = require("./webpack2")\n// const webpack = require("webpack")\nconst webpackConfig = require("./webpack.config")\ndebugger\nconst compiler = webpack(webpackConfig)\n//4.\u6267\u884c`Compiler`\u5bf9\u8c61\u7684 run \u65b9\u6cd5\u5f00\u59cb\u6267\u884c\u7f16\u8bd1\ncompiler.run((err, stats) => {\n  if (err) {\n    console.log(err)\n  } else {\n    //stats\u4ee3\u8868\u7edf\u8ba1\u7ed3\u679c\u5bf9\u8c61\n    const statsJson = JSON.stringify(\n      stats.toJson({\n        // files: true, //\u4ee3\u8868\u6253\u5305\u540e\u751f\u6210\u7684\u6587\u4ef6\n        assets: true, //\u5176\u5b9e\u662f\u4e00\u4e2a\u4ee3\u7801\u5757\u5230\u6587\u4ef6\u7684\u5bf9\u5e94\u5173\u7cfb\n        chunks: true, //\u4ece\u5165\u53e3\u6a21\u5757\u51fa\u53d1\uff0c\u627e\u5230\u6b64\u5165\u53e3\u6a21\u5757\u4f9d\u8d56\u7684\u6a21\u5757\uff0c\u6216\u8005\u4f9d\u8d56\u7684\u6a21\u5757\u4f9d\u8d56\u7684\u6a21\u5757\uff0c\u5408\u5728\u4e00\u8d77\u7ec4\u6210\u4e00\u4e2a\u4ee3\u7801\u5757\n        modules: true, //\u6253\u5305\u7684\u6a21\u5757 \u6bcf\u4e2a\u6587\u4ef6\u90fd\u662f\u4e00\u4e2a\u6a21\u5757\n      })\n    )\n\n    fs.writeFileSync("./statsJson.json", statsJson)\n  }\n})\n')),(0,a.kt)("h3",{id:"16-webpackjs"},"1.6 webpack.js"),(0,a.kt)("p",null,"webpack2.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const Compiler = require("./Compiler")\nfunction webpack(options) {\n  // 1.\u521d\u59cb\u5316\u53c2\u6570\uff1a\u4ece\u914d\u7f6e\u6587\u4ef6\u548c Shell \u8bed\u53e5\u4e2d\u8bfb\u53d6\u5e76\u5408\u5e76\u53c2\u6570,\u5f97\u51fa\u6700\u7ec8\u7684\u914d\u7f6e\u5bf9\u8c61\n  //argv[0]\u662fNode\u7a0b\u5e8f\u7684\u7edd\u5bf9\u8def\u5f84 argv[1] \u6b63\u5728\u8fd0\u884c\u7684\u811a\u672c\n  // node debugger --mode=production\n  const argv = process.argv.slice(2)\n  const shellOptions = argv.reduce((shellOptions, options) => {\n    // options = \'--mode=development\'\n    const [key, value] = options.split("=")\n    shellOptions[key.slice(2)] = value\n    return shellOptions\n  }, {})\n  console.log("shellOptions=>", shellOptions)\n  const finalOptions = { ...options, ...shellOptions }\n  //2.\u7528\u4e0a\u4e00\u6b65\u5f97\u5230\u7684\u53c2\u6570\u521d\u59cb\u5316 `Compiler` \u5bf9\u8c61\n  const compiler = new Compiler(finalOptions)\n  //3.\u52a0\u8f7d\u6240\u6709\u914d\u7f6e\u7684\u63d2\u4ef6\n  const { plugins } = finalOptions\n  for (let plugin of plugins) {\n    //\u8ba2\u9605\u94a9\u5b50\n    plugin.apply(compiler)\n  }\n  return compiler\n}\nmodule.exports = webpack\n')),(0,a.kt)("h3",{id:"17-compiler"},"1.7 Compiler"),(0,a.kt)("p",null,"Compiler.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const { SyncHook } = require("tapable")\nconst Compilation = require("./Compilation")\nconst fs = require("fs")\nconst path = require("path")\n// Compiler \u6a21\u5757\u662f webpack \u7684\u4e3b\u8981\u5f15\u64ce\nclass Compiler {\n  constructor(options) {\n    this.options = options\n    this.hooks = {\n      run: new SyncHook(), //\u5728\u5f00\u59cb\u7f16\u8bd1\u4e4b\u524d\u8c03\u7528\n      done: new SyncHook(), //\u5728\u7f16\u8bd1\u5b8c\u6210\u65f6\u6267\u884c\n    }\n  }\n  run(callback) {\n    this.hooks.run.call() //\u5728\u7f16\u8bd1\u5f00\u59cb\u524d\u89e6\u53d1run\u94a9\u5b50\u6267\u884c\n    //\u5728\u7f16\u8bd1\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u6536\u96c6\u6240\u6709\u7684\u4f9d\u8d56\u7684\u6a21\u5757\u6216\u8005\u8bf4\u6587\u4ef6\n    //stats\u6307\u7684\u662f\u7edf\u8ba1\u4fe1\u606f modules chunks  files=bundle assets\u6307\u7684\u662f\u6587\u4ef6\u540d\u548c\u6587\u4ef6\u5185\u5bb9\u7684\u6620\u5c04\u5173\u7cfb\n    const onCompiled = (err, stats, fileDependencies) => {\n      // 10.\u5728\u786e\u5b9a\u597d\u8f93\u51fa\u5185\u5bb9\u540e\uff0c\u6839\u636e\u914d\u7f6e\u786e\u5b9a\u8f93\u51fa\u7684\u8def\u5f84\u548c\u6587\u4ef6\u540d\uff0c\u628a\u6587\u4ef6\u5185\u5bb9\u5199\u5165\u5230\u6587\u4ef6\u7cfb\u7edf\n      for (let filename in stats.assets) {\n        let filePath = path.join(this.options.output.path, filename)\n        fs.writeFileSync(filePath, stats.assets[filename], "utf8")\n      }\n      callback(err, { toJson: () => stats })\n      for (let fileDependency of fileDependencies) {\n        //\u76d1\u542c\u4f9d\u8d56\u7684\u6587\u4ef6\u53d8\u5316\uff0c\u5982\u679c\u4f9d\u8d56\u7684\u6587\u4ef6\u53d8\u5316\u540e\u4f1a\u5f00\u59cb\u4e00\u6b21\u65b0\u7684\u7f16\u8bd1\n        fs.watch(fileDependency, () => this.compile(onCompiled))\n      }\n    }\n    //\u8c03\u7528compile\u65b9\u6cd5\u8fdb\u884c\u7f16\u8bd1  \u5f00\u59cb\u4e00\u6b21\u65b0\u7684\u7f16\u8bd1\n    this.compile(onCompiled)\n    this.hooks.done.call() //\u5728\u7f16\u8bd1\u5b8c\u6210\u65f6\u89e6\u53d1done\u94a9\u5b50\u6267\u884c\n  }\n  //\u5f00\u542f\u4e00\u6b21\u65b0\u7684\u7f16\u8bd1\n  compile(callback) {\n    //\u6bcf\u6b21\u7f16\u8bd1 \u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Compilation\u5b9e\u4f8b\n    let compilation = new Compilation(this.options, this)\n    compilation.build(callback)\n  }\n}\nmodule.exports = Compiler\n')),(0,a.kt)("h3",{id:"18-compilation"},"1.8 Compilation"),(0,a.kt)("p",null,"Compilation.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const path = require("path")\nconst fs = require("fs")\nconst parser = require("@babel/parser")\nconst types = require("@babel/types")\nconst traverse = require("@babel/traverse").default\nconst generator = require("@babel/generator").default\nconst baseDir = normalizePath(process.cwd())\nfunction normalizePath(path) {\n  return path.replace(/\\\\/g, "/")\n}\nclass Compilation {\n  constructor(options, compiler) {\n    this.options = options // \u914d\u7f6e\u53c2\u6570\n    this.options.context = this.options.context || normalizePath(process.cwd())\n    this.compiler = compiler\n    this.modules = [] //\u8fd9\u91cc\u653e\u7f6e\u672c\u6b21\u7f16\u8bd1\u6d89\u53ca\u7684\u6240\u6709\u7684\u6a21\u5757\n    this.chunks = [] //\u672c\u6b21\u7f16\u8bd1\u6240\u7ec4\u88c5\u51fa\u7684\u4ee3\u7801\u5757\n    this.assets = {} // \u5b58\u653e\u8f93\u51fa\u7684\u6587\u4ef6 key\u662f\u6587\u4ef6\u540d,\u503c\u662f\u6587\u4ef6\u5185\u5bb9\n    this.files = [] //\u4ee3\u8868\u672c\u6b21\u6253\u5305\u51fa\u6765\u7684\u6587\u4ef6\n    this.fileDependencies = new Set() //\u672c\u6b21\u7f16\u8bd1\u4f9d\u8d56\u7684\u6587\u4ef6\u6216\u8005\u8bf4\u6a21\u5757\n  }\n  build(callback) {\n    //5.\u6839\u636e\u914d\u7f6e\u4e2d\u7684entry\u627e\u51fa\u5165\u53e3\u6587\u4ef6\n    let entry = {}\n    //\u683c\u5f0f\u5316\u5165\u53e3\u6587\u4ef6\n    if (typeof this.options.entry === "string") {\n      entry.main = this.options.entry\n    } else {\n      entry = this.options.entry\n    }\n    // \u5bf9\u5165\u53e3\u8fdb\u884c\u904d\u5386\n    for (let entryName in entry) {\n      //\u83b7\u53d6\u5165\u53e3\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\n      let entryFilePath = path.posix.join(baseDir, entry[entryName])\n      //\u628a\u6b64\u5165\u53e3\u6587\u4ef6\u6dfb\u52a0\u5230\u6587\u4ef6\u4f9d\u8d56\u5217\u8868\u4e2d\n      this.fileDependencies.add(entryFilePath)\n      //6.\u4ece\u5165\u53e3\u6587\u4ef6\u51fa\u53d1,\u8c03\u7528\u6240\u6709\u914d\u7f6e\u7684Loader\u5bf9\u6a21\u5757\u8fdb\u884c\u7f16\u8bd1\n      let entryModule = this.buildModule(entryName, entryFilePath)\n      // this.modules.push(entryModule)\n      // 8.\u6839\u636e\u5165\u53e3\u548c\u6a21\u5757\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u7ec4\u88c5\u6210\u4e00\u4e2a\u4e2a\u5305\u542b\u591a\u4e2a\u6a21\u5757\u7684 Chunk\n      let chunk = {\n        name: entryName, //\u5165\u53e3\u540d\u79f0\n        entryModule, //\u5165\u53e3\u7684\u6a21\u5757 ./src/entry.js\n        modules: this.modules.filter((module) =>\n          module.names.includes(entryName)\n        ), //\u6b64\u5165\u53e3\u5bf9\u5e94\u7684\u6a21\u5757\n      }\n      this.chunks.push(chunk)\n    }\n\n    // 9.\u518d\u628a\u6bcf\u4e2a Chunk \u8f6c\u6362\u6210\u4e00\u4e2a\u5355\u72ec\u7684\u6587\u4ef6\u52a0\u5165\u5230\u8f93\u51fa\u5217\u8868\n    this.chunks.forEach((chunk) => {\n      const filename = this.options.output.filename.replace(\n        "[name]",\n        chunk.name\n      )\n      this.files.push(filename)\n      //\u7ec4\u88c5chunk\n      this.assets[filename] = getSource(chunk)\n    })\n    callback(\n      null,\n      {\n        modules: this.modules,\n        chunks: this.chunks,\n        assets: this.assets,\n        files: this.files,\n      },\n      this.fileDependencies\n    )\n  }\n  /**\n   * \u7f16\u8bd1\u6a21\u5757\n   * @param {*} name \u6a21\u5757\u6240\u5c5e\u7684\u4ee3\u7801\u5757(chunk)\u7684\u540d\u79f0\uff0c\u4e5f\u5c31\u662fentry\u7684name entry1 entry2\n   * @param {*} modulePath \u6a21\u5757\u7684\u7edd\u5bf9\u8def\u5f84\n   */\n  buildModule(entryName, modulePath) {\n    //1.\u8bfb\u53d6\u6587\u4ef6\u7684\u5185\u5bb9\n    let rawSourceCode = fs.readFileSync(modulePath, "utf8")\n    //\u83b7\u53d6loader\u7684\u914d\u7f6e\u89c4\u5219\n    let { rules } = this.options.module\n    //\u6839\u636e\u89c4\u5219\u627e\u5230\u6240\u6709\u7684\u5339\u914d\u7684loader \u9002\u7528\u4e8e\u6b64\u6a21\u5757\u7684\u6240\u6709loader\n    let loaders = []\n    rules.forEach((rule) => {\n      //\u7528\u6a21\u5757\u8def\u5f84\u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f\n      if (modulePath.match(rule.test)) {\n        loaders.push(...rule.use)\n      }\n    })\n    //\u8c03\u7528\u6240\u6709\u914d\u7f6e\u7684Loader\u5bf9\u6a21\u5757\u8fdb\u884c\u8f6c\u6362\n\n    let transformedSourceCode = loaders.reduceRight(\n      (sourceCode, loaderPath) => {\n        const loaderFn = require(loaderPath)\n        return loaderFn(sourceCode)\n      },\n      rawSourceCode\n    )\n\n    //7.\u518d\u627e\u51fa\u8be5\u6a21\u5757\u4f9d\u8d56\u7684\u6a21\u5757\uff0c\u518d\u9012\u5f52\u672c\u6b65\u9aa4\u76f4\u5230\u6240\u6709\u5165\u53e3\u4f9d\u8d56\u7684\u6587\u4ef6\u90fd\u7ecf\u8fc7\u4e86\u672c\u6b65\u9aa4\u7684\u5904\u7406\n    //\u83b7\u53d6\u5f53\u524d\u6a21\u5757\uff0c\u4e5f\u5c31\u662f ./src/entry1.js\u7684\u6a21\u5757ID\n    let moduleId = "./" + path.posix.relative(baseDir, modulePath)\n    //\u521b\u5efa\u4e00\u4e2a\u6a21\u5757ID\u5c31\u662f\u76f8\u5bf9\u4e8e\u6839\u76ee\u5f55\u7684\u76f8\u5bf9\u8def\u5f84 dependencies\u5c31\u662f\u6b64\u6a21\u5757\u4f9d\u8d56\u7684\u6a21\u5757\n    //name\u662f\u6a21\u5757\u6240\u5c5e\u7684\u4ee3\u7801\u5757\u7684\u540d\u79f0,\u5982\u679c\u4e00\u4e2a\u6a21\u5757\u5c5e\u4e8e\u591a\u4e2a\u4ee3\u7801\u5757\uff0c\u90a3\u4e48name\u5c31\u662f\u4e00\u4e2a\u6570\u7ec4\n    let module = { id: moduleId, dependencies: new Set(), names: [entryName] }\n    this.modules.push(module)\n    let ast = parser.parse(transformedSourceCode, { sourceType: "module" })\n    //Visitor\u662fbabel\u63d2\u4ef6\u4e2d\u7684\u6982\u5ff5\uff0c\u6b64\u5904\u6ca1\u6709\n    traverse(ast, {\n      CallExpression: ({ node }) => {\n        //\u5982\u679c\u8c03\u7528\u7684\u65b9\u6cd5\u540d\u662frequire\u7684\u8bdd\uff0c\u8bf4\u660e\u5c31\u8981\u4f9d\u8d56\u4e00\u4e2a\u5176\u5b83\u6a21\u5757\n        if (node.callee.name === "require") {\n          // .\u4ee3\u8868\u5f53\u524d\u7684\u6a21\u5757\u6240\u6709\u7684\u76ee\u5f55\uff0c\u4e0d\u662f\u5de5\u4f5c\u76ee\u5f55\n          let depModuleName = node.arguments[0].value //"./title"\n          let depModulePath\n          //\u83b7\u53d6\u5f53\u524d\u7684\u6a21\u5757\u6240\u5728\u7684\u76ee\u5f55\n          if (depModuleName.startsWith(".")) {\n            //\u6682\u65f6\u5148\u4e0d\u8003\u8651node_modules\u91cc\u7684\u6a21\u5757\uff0c\u5148\u53ea\u8003\u8651\u76f8\u5bf9\u8def\u5f84\n            const currentDir = path.posix.dirname(modulePath)\n            //\u8981\u627e\u5f53\u524d\u6a21\u5757\u6240\u6709\u5728\u7684\u76ee\u5f55\u4e0b\u9762\u7684\u76f8\u5bf9\u8def\u5f84\n            depModulePath = path.posix.join(currentDir, depModuleName)\n            //\u6b64\u7edd\u5bf9\u8def\u5f84\u53ef\u80fd\u6ca1\u6709\u540e\u7eed\uff0c\u9700\u8981\u5c1d\u8bd5\u6dfb\u52a0\u540e\u7f00\n            // \u83b7\u53d6\u914d\u7f6e\u7684\u6269\u5c55\u540d\u540e\u7f00\n            const extensions = this.options.resolve.extensions\n            //\u5c1d\u8bd5\u6dfb\u52a0\u540e\u7f00 \u8fd4\u56de\u6700\u7ec8\u7684\u8def\u5f84\n            depModulePath = tryExtensions(depModulePath, extensions)\n          } else {\n            //\u5982\u679c\u4e0d\u662f\u4ee5.\u5f00\u5934\u7684\u8bdd\uff0c\u5c31\u662f\u7b2c\u4e09\u65b9\u6a21\u5757\n            depModulePath = require.resolve(depModuleName)\n          }\n          //\u628a\u4f9d\u8d56\u7684\u6a21\u5757\u8def\u5f84\u6dfb\u52a0\u5230\u6587\u4ef6\u4f9d\u8d56\u5217\u8868\n          this.fileDependencies.add(depModulePath)\n          //\u83b7\u53d6\u6b64\u4f9d\u8d56\u7684\u6a21\u5757\u7684ID, \u4e5f\u5c31\u662f\u76f8\u5bf9\u4e8e\u6839\u76ee\u5f55\u7684\u76f8\u5bf9\u8def\u5f84\n          let depModuleId = "./" + path.posix.relative(baseDir, depModulePath)\n          //\u4fee\u6539\u8bed\u6cd5\u6811\uff0c\u628a\u4f9d\u8d56\u7684\u6a21\u5757\u540d\u6362\u6210\u6a21\u5757ID\n          node.arguments[0] = types.stringLiteral(depModuleId)\n          //\u628a\u4f9d\u8d56\u7684\u6a21\u5757ID\u548c\u4f9d\u8d56\u7684\u6a21\u5757\u8def\u5f84\u653e\u7f6e\u5230\u5f53\u524d\u6a21\u5757\u7684\u4f9d\u8d56\u6570\u7ec4\u4e2d\n          module.dependencies.add({ depModuleId, depModulePath })\n        }\n      },\n    })\n    //\u8f6c\u6362\u6e90\u4ee3\u7801,\u628a\u8f6c\u6362\u540e\u7684\u6e90\u7801\u653e\u5728_source\u5c5e\u6027,\u7528\u4e8e\u540e\u9762\u5199\u5165\u6587\u4ef6\n    let { code } = generator(ast)\n    module._source = code\n    ;[...module.dependencies].forEach(({ depModuleId, depModulePath }) => {\n      //\u5224\u65ad\u6b64\u4f9d\u8d56\u7684\u6a21\u5757\u662f\u5426\u5df2\u7ecf\u6253\u5305\u8fc7\u4e86\u6216\u8005\u8bf4\u7f16\u8bd1 \u8fc7\u4e86\n      let existModule = this.modules.find((module) => module.id === depModuleId)\n      if (existModule) {\n        existModule.names.push(entryName)\n      } else {\n        let depModule = this.buildModule(entryName, depModulePath)\n        this.modules.push(depModule)\n      }\n    })\n    return module\n  }\n}\n/**\n *\n * @param {*} modulePath\n * @param {*} extensions\n * @returns\n */\nfunction tryExtensions(modulePath, extensions) {\n  if (fs.existsSync(modulePath)) {\n    return modulePath\n  }\n  for (let i = 0; i < extensions.length; i++) {\n    let filePath = modulePath + extensions[i]\n    if (fs.existsSync(filePath)) {\n      return filePath\n    }\n  }\n  throw new Error(`\u627e\u4e0d\u5230${modulePath}`)\n}\nfunction getSource(chunk) {\n  return `\n  (() => {\n    var modules = {\n      ${chunk.modules\n        .filter((module) => module.id !== chunk.entryModule.id)\n        .map(\n          (module) => `\n          "${module.id}": module => {\n            ${module._source}\n          }\n        `\n        )\n        .join(",")}\n    };\n    var cache = {};\n    function require(moduleId) {\n      var cachedModule = cache[moduleId];\n      if (cachedModule !== undefined) {\n        return cachedModule.exports;\n      }\n      var module = cache[moduleId] = {\n        exports: {}\n      };\n      modules[moduleId](module, module.exports, require);\n      return module.exports;\n    }\n    var exports = {};\n    (() => {\n      ${chunk.entryModule._source}\n    })();\n  })();\n  `\n}\nmodule.exports = Compilation\n')),(0,a.kt)("p",null,"webpack2.js"),(0,a.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,a.kt)("h3",{id:"1-\u6587\u4ef6\u4f5c\u7528"},"1. \u6587\u4ef6\u4f5c\u7528"),(0,a.kt)("h4",{id:"webpackjs-\u6587\u4ef6"},(0,a.kt)("strong",{parentName:"h4"},"webpack.js \u6587\u4ef6")),(0,a.kt)("p",null,"webpack \u65b9\u6cd5"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u63a5\u6536 webpack.config.js \u53c2\u6570\uff0c\u8fd4\u56de compiler \u5b9e\u4f8b"),(0,a.kt)("li",{parentName:"ol"},"\u521d\u59cb\u5316\u53c2\u6570"),(0,a.kt)("li",{parentName:"ol"},"\u59cb\u5316 Compiler \u5bf9\u8c61\u5b9e\u4f8b"),(0,a.kt)("li",{parentName:"ol"},"\u52a0\u8f7d\u6240\u6709\u914d\u7f6e\u7684\u63d2\u4ef6")),(0,a.kt)("h4",{id:"compiler\u6587\u4ef6"},(0,a.kt)("strong",{parentName:"h4"},"Compiler"),"\u6587\u4ef6"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Compiler \u6a21\u5757\u662f ",(0,a.kt)("strong",{parentName:"p"},"webpack \u7684\u4e3b\u8981\u5f15\u64ce"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"constructor \u65b9\u6cd5"),"\uff1a \u521d\u59cb\u5316\u4e00\u4e9b hooks")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"run \u65b9\u6cd5")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u6267\u884c\u63d2\u4ef6\u8ba2\u9605\u7684\u4e00\u7cfb\u5217 hooks"),(0,a.kt)("li",{parentName:"ul"},"\u521b\u5efa Compilation \u5b9e\u4f8b\u5e76\u6267\u884c\u5b9e\u4f8b\u7684 build\uff08onCompiled\uff09\u65b9\u6cd5\uff08\u5f00\u542f\u4e00\u6b21\u65b0\u7684\u7f16\u8bd1\uff09"),(0,a.kt)("li",{parentName:"ul"},"onCompiled \u56de\u8c03",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u5728\u786e\u5b9a\u597d\u8f93\u51fa\u5185\u5bb9\u540e\uff0c\u6839\u636e\u914d\u7f6e\u786e\u5b9a\u8f93\u51fa\u7684\u8def\u5f84\u548c\u6587\u4ef6\u540d\uff0c\u628a\u6587\u4ef6\u5185\u5bb9\u5199\u5165\u5230\u6587\u4ef6\u7cfb\u7edf"),(0,a.kt)("li",{parentName:"ul"},"\u6267\u884c compiler.run \u65b9\u6cd5\u7684\u56de\u8c03\uff0c\u4f20\u5165 info"),(0,a.kt)("li",{parentName:"ul"},"\u76d1\u542c\u4f9d\u8d56\u7684\u6587\u4ef6\u53d8\u5316\uff0c\u5982\u679c\u4f9d\u8d56\u7684\u6587\u4ef6\u53d8\u5316\u540e\u4f1a\u5f00\u59cb\u4e00\u6b21\u65b0\u7684\u7f16\u8bd1")))))),(0,a.kt)("h4",{id:"compilation-\u6587\u4ef6"},"Compilation \u6587\u4ef6"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"build \u65b9\u6cd5")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},".\u6839\u636e\u914d\u7f6e\u4e2d\u7684 entry \u627e\u51fa\u5165\u53e3\u6587\u4ef6"),(0,a.kt)("li",{parentName:"ol"},"\u4ece\u5165\u53e3\u6587\u4ef6\u51fa\u53d1,\u8c03\u7528\u6240\u6709\u914d\u7f6e\u7684 Loader \u5bf9\u6a21\u5757\u8fdb\u884c\u7f16\u8bd1"),(0,a.kt)("li",{parentName:"ol"},"\u518d\u627e\u51fa\u8be5\u6a21\u5757\u4f9d\u8d56\u7684\u6a21\u5757\uff0c\u518d\u9012\u5f52\u672c\u6b65\u9aa4\u76f4\u5230\u6240\u6709\u5165\u53e3\u4f9d\u8d56\u7684\u6587\u4ef6\u90fd\u7ecf\u8fc7\u4e86\u672c\u6b65\u9aa4\u7684\u5904\u7406"),(0,a.kt)("li",{parentName:"ol"},"\u6839\u636e\u5165\u53e3\u548c\u6a21\u5757\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u7ec4\u88c5\u6210\u4e00\u4e2a\u4e2a\u5305\u542b\u591a\u4e2a\u6a21\u5757\u7684 Chunk"),(0,a.kt)("li",{parentName:"ol"},"\u518d\u628a\u6bcf\u4e2a Chunk \u8f6c\u6362\u6210\u4e00\u4e2a\u5355\u72ec\u7684\u6587\u4ef6\u52a0\u5165\u5230\u8f93\u51fa\u5217\u8868"),(0,a.kt)("li",{parentName:"ol"},"\u6267\u884c\u6210\u529f\u540e\u7684\u56de\u8c03")),(0,a.kt)("h3",{id:"2-\u6d41\u7a0b\u603b\u7ed3"},"2. \u6d41\u7a0b\u603b\u7ed3"),(0,a.kt)("h4",{id:"\u521d\u59cb\u5316\u53c2\u6570"},(0,a.kt)("strong",{parentName:"h4"},"\u521d\u59cb\u5316\u53c2\u6570\uff1a")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"\u521d\u59cb\u5316\u53c2\u6570"),"\uff1a\u4ece\u914d\u7f6e\u6587\u4ef6\u548c Shell \u8bed\u53e5\u4e2d\u8bfb\u53d6\u5e76\u5408\u5e76\u53c2\u6570,\u5f97\u51fa\u6700\u7ec8\u7684\u914d\u7f6e\u5bf9\u8c61\uff08\u547d\u4ee4\u884c\u4f18\u5148\u7ea7\u9ad8\uff09")),(0,a.kt)("h4",{id:"\u5f00\u59cb\u7f16\u8bd1"},(0,a.kt)("strong",{parentName:"h4"},"\u5f00\u59cb\u7f16\u8bd1")),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u7528\u4e0a\u4e00\u6b65\u5f97\u5230\u7684\u53c2\u6570",(0,a.kt)("strong",{parentName:"p"},"\u521d\u59cb\u5316 Compiler \u5bf9\u8c61")),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u521d\u59cb\u5316 options \u53c2\u6570\u548c hooks \uff08",(0,a.kt)("inlineCode",{parentName:"li"}," run: new SyncHook()"),", //\u5728\u5f00\u59cb\u7f16\u8bd1\u4e4b\u524d\u8c03\u7528...\uff09"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u52a0\u8f7d"),"\u6240\u6709\u914d\u7f6e\u7684",(0,a.kt)("strong",{parentName:"p"},"\u63d2\u4ef6"),"\uff1a"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u5728\u914d\u7f6e\u4e2d\u627e\u5230 plugins \u6570\u7ec4"),(0,a.kt)("li",{parentName:"ol"},"\u904d\u5386 plugins \u6267\u884c\u6bcf\u4e2a\u63d2\u4ef6\u7684 apply \u65b9\u6cd5\uff0c\u5e76\u628a compiler \u5b9e\u4f8b\u4f20\u8fdb\u53bb\uff08\u6bcf\u4e2a\u63d2\u4ef6\u90fd\u6709\u4e00\u4e2a apply \u65b9\u6cd5\uff09"),(0,a.kt)("li",{parentName:"ol"},"\u6267\u884c",(0,a.kt)("inlineCode",{parentName:"li"}," compiler.hooks.run.tap"),"\u7b49\u65b9\u6cd5\u6ce8\u518c\u4e8b\u4ef6"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u6267\u884c"),(0,a.kt)("inlineCode",{parentName:"p"},"compiler"),"\u5b9e\u4f8b\u7684 ",(0,a.kt)("strong",{parentName:"p"},"run \u65b9\u6cd5"),"\u5f00\u59cb\u6267\u884c\u7f16\u8bd1"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u6574\u4e2a\u8fc7\u7a0b\u4f34\u968f\u7740\u89e6\u53d1\u63d2\u4ef6\u7684\u6ce8\u518c\u4e2a\u5404\u79cd\u94a9\u5b50\u51fd\u6570",(0,a.kt)("inlineCode",{parentName:"li"}," this.hooks.done.call()"),"..."),(0,a.kt)("li",{parentName:"ol"},"\u5f00\u542f\u4e00\u6b21\u65b0\u7684\u7f16\u8bd1\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Compilation \u5b9e\u4f8b"),(0,a.kt)("li",{parentName:"ol"},"\u6267\u884c\u5b9e\u4f8b\u7684 build \u65b9\u6cd5\uff0c\u4f20\u5165\u5b8c\u6210\u7684\u56de\u8c03")))),(0,a.kt)("h4",{id:"\u7f16\u8bd1\u6a21\u5757"},(0,a.kt)("strong",{parentName:"h4"},"\u7f16\u8bd1\u6a21\u5757")),(0,a.kt)("ol",{start:5},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u6839\u636e\u914d\u7f6e\u4e2d\u7684 entry \u627e\u51fa\u5165\u53e3\u6587\u4ef6"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u683c\u5f0f\u5316\u5165\u53e3\u6587\u4ef6\uff0c\u53d8\u6210\u5bf9\u8c61\u5f62\u5f0f"),(0,a.kt)("li",{parentName:"ol"},"\u5bf9\u5165\u53e3\u8fdb\u884c\u904d\u5386\uff0c\u83b7\u53d6\u5165\u53e3\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u6dfb\u52a0\u5230\u6587\u4ef6\u4f9d\u8d56\u5217\u8868\u4e2d"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"loader \u8f6c\u6362"),"\uff1a\u4ece\u5165\u53e3\u6587\u4ef6\u51fa\u53d1,\u8c03\u7528\u6240\u6709\u914d\u7f6e\u7684 Loader \u5bf9\u6a21\u5757\u8fdb\u884c\u8f6c\u6362 \uff08\u6700\u7ec8\u8fd4\u56de module \u5bf9\u8c61\uff09"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u8bfb\u53d6\u5904\u7406\u6587\u4ef6\u7684\u5185\u5bb9")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u6839\u636e\u89c4\u5219\u627e\u5230\u6240\u6709\u7684\u5339\u914d\u7684 loader")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u8c03\u7528\u6240\u6709\u914d\u7f6e\u7684 Loader \u5bf9\u6a21\u5757\u8fdb\u884c\u8f6c\u6362\uff08\u4ece\u4e0a\u5230\u4e0b\uff0c\u4ece\u53f3\u5411\u5de6\uff09")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u83b7\u53d6\u5f53\u524d\u6a21\u5757\u6a21\u5757 id\uff0c\u76f8\u5bf9\u4e8e\u6839\u76ee\u5f55\u7684\u76f8\u5bf9\u8def\u5f84")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u521b\u5efa\u4e00\u4e2a module \u5bf9\u8c61"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const module = {\n    id:'./src/entry1.js',//\u76f8\u5bf9\u4e8e\u6839\u76ee\u5f55\u7684\u76f8\u5bf9\u8def\u5f84\n     dependencies:[{depModuleId:./src/title.js,depModulePath:'xxx'}],//dependencies\u5c31\u662f\u6b64\u6a21\u5757\u4f9d\u8d56\u7684\u6a21\u5757\n    names:['entry1'],// name\u662f\u6a21\u5757\u6240\u5c5e\u7684\u4ee3\u7801\u5757\u7684\u540d\u79f0,\u5982\u679c\u4e00\u4e2a\u6a21\u5757\u5c5e\u4e8e\u591a\u4e2a\u4ee3\u7801\u5757\uff0c\u90a3\u4e48name\u5c31\u662f\u4e00\u4e2a\u6570\u7ec4\n2.\n     _source:'xxx',//\u5b58\u653e\u5bf9\u5e94\u7684\u6e90\u7801\n}\n"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u7f16\u8bd1\u6a21\u5757\u5206\u6790\u4f9d\u8d56"),"\uff0c\u518d",(0,a.kt)("strong",{parentName:"p"},"\u9012\u5f52\u904d\u5386"),"\u672c\u6b65\u9aa4\u76f4\u5230\u6240\u6709\u5165\u53e3",(0,a.kt)("strong",{parentName:"p"},"\u4f9d\u8d56\u6a21\u5757"),"\u7684\u6587\u4ef6\u90fd\u7ecf\u8fc7\u4e86\u672c\u6b65\u9aa4\u7684\u5904\u7406"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u5c06 loader \u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u8c03\u7528 parse \u8f6c\u6362\u4e3a ast"),(0,a.kt)("li",{parentName:"ol"},"\u904d\u5386\u8bed\u6cd5\u6811\uff0c\u5982\u679c\u5b58\u5728 require \u6216\u8005 import\uff0c\u8bf4\u660e\u5c31\u8981\u4f9d\u8d56\u4e00\u4e2a\u5176\u5b83\u6a21\u5757"),(0,a.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u4f9d\u8d56\u6a21\u5757\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u6dfb\u52a0\u5230\u6587\u4ef6\u4f9d\u8d56\u5217\u8868\u4e2d"),(0,a.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u6b64\u4f9d\u8d56\u7684\u6a21\u5757\u7684 ID, \u4e5f\u5c31\u662f\u76f8\u5bf9\u4e8e\u6839\u76ee\u5f55\u7684\u76f8\u5bf9\u8def\u5f84"),(0,a.kt)("li",{parentName:"ol"},"\u4fee\u6539\u8bed\u6cd5\u6811\uff0c\u628a\u4f9d\u8d56\u7684\u6a21\u5757\u540d\u6362\u6210\u6a21\u5757 ID"),(0,a.kt)("li",{parentName:"ol"},"\u628a\u4f9d\u8d56\u7684\u6a21\u5757 ID \u548c\u4f9d\u8d56\u7684\u6a21\u5757\u8def\u5f84\u653e\u7f6e\u5230\u5f53\u524d\u6a21\u5757 module \u7684\u4f9d\u8d56\u6570\u7ec4\u4e2d"),(0,a.kt)("li",{parentName:"ol"},"\u8c03\u7528 generator\uff08ast\uff09\uff0c\u628a\u8f6c\u6362\u540e\u7684\u6e90\u7801\u653e\u5728 module.","_","source \u5c5e\u6027,\u7528\u4e8e\u540e\u9762\u5199\u5165\u6587\u4ef6"),(0,a.kt)("li",{parentName:"ol"},"\u904d\u5386",(0,a.kt)("inlineCode",{parentName:"li"},"module.dependencies"),"\uff0c\u9012\u5f52\u6784\u5efa module\uff0c\u6784\u5efa\u597d\u7684\u5b58\u50a8\u5230 this.modules \u4e0a\uff0c\u5982\u679c\u7b2c\u4e8c\u4e2a\u5165\u53e3\u4e5f\u4f9d\u8d56\u8be5\u6a21\u5757\uff0c\u76f4\u63a5\u53d6\u7528\uff0c\u53ea\u9700\u8981\u7ed9\u8be5\u6a21\u5757\u7684 name \u5c5e\u6027\u4e0a\u6dfb\u52a0\u4e0a\u5165\u53e3\u4fe1\u606f")))),(0,a.kt)("h4",{id:"\u8f93\u51fa\u8d44\u6e90"},(0,a.kt)("strong",{parentName:"h4"},"\u8f93\u51fa\u8d44\u6e90")),(0,a.kt)("ol",{start:8},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u7ec4\u88c5 chuck \u5bf9\u8c61\uff1a")),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u7ec4\u88c5")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const chuck = {\n  name: "entry1", //\u5165\u53e3\u540d\u79f0\n  entryModule, //\u5165\u53e3\u7684\u6a21\u5757\u7684module {id,name,dependencies,_source}\n  modules: [{}], // \u5165\u53e3\u4f9d\u8d56\u6a21\u5757\u7684\u96c6\u5408\n}\n')),(0,a.kt)("ol",{parentName:"li",start:2},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"this.chunks.push(chunk)"))))),(0,a.kt)("h4",{id:"\u751f\u6210-bundle-\u6587\u4ef6"},"\u751f\u6210 bundle \u6587\u4ef6"),(0,a.kt)("ol",{start:9},(0,a.kt)("li",{parentName:"ol"},"\u628a\u6bcf\u4e2a Chunk \u8f6c\u6362\u6210\u4e00\u4e2a\u5355\u72ec\u7684\u6587\u4ef6\u52a0\u5165\u5230\u8f93\u51fa\u5217\u8868",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u8981\u751f\u6210\u7684\u6587\u4ef6\u540d\u79f0\u5e76\u628a\u6587\u4ef6\u540d\u6dfb\u52a0\u5230 this.files \u4e2d"),(0,a.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u6587\u4ef6\u5185\u5bb9\u5e76\u7ed9 this.assets \u5bf9\u8c61"),(0,a.kt)("li",{parentName:"ol"},"\u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"li"},"compilation.build")," \u65b9\u6cd5\u7684\u56de\u8c03")))),(0,a.kt)("h4",{id:"\u5199\u5165\u6587\u4ef6"},"\u5199\u5165\u6587\u4ef6"),(0,a.kt)("ol",{start:10},(0,a.kt)("li",{parentName:"ol"},"\u5728\u786e\u5b9a\u597d\u8f93\u51fa\u5185\u5bb9\u540e\uff0c\u6839\u636e\u914d\u7f6e\u786e\u5b9a\u8f93\u51fa\u7684\u8def\u5f84\u548c\u6587\u4ef6\u540d\uff0c\u628a\u6587\u4ef6\u5185\u5bb9\u5199\u5165\u5230\u6587\u4ef6\u7cfb\u7edf")))}m.isMDXComponent=!0}}]);