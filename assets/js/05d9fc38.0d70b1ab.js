"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1197],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>v});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=c(n),v=r,d=m["".concat(l,".").concat(v)]||m[v]||u[v]||i;return n?a.createElement(d,s(s({ref:t},p),{},{components:n})):a.createElement(d,s({ref:t},p))}));function v(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var c=2;c<i;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3344:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const i={title:"React\u7684\u4e8b\u4ef6\u673a\u5236",last_update:{date:"08/29/2024",author:"\u9ad8\u7ea2\u7fd4"}},s=void 0,o={unversionedId:"06React\u4e8b\u4ef6\u673a\u5236",id:"06React\u4e8b\u4ef6\u673a\u5236",title:"React\u7684\u4e8b\u4ef6\u673a\u5236",description:"\u5408\u6210\u4e8b\u4ef6\u662f\u56f4\u7ed5\u6d4f\u89c8\u5668\u539f\u751f\u4e8b\u4ef6\u5145\u5f53\u8de8\u6d4f\u89c8\u5668\u5305\u88c5\u5668\u7684\u5bf9\u8c61,\u5b83\u4eec\u5c06\u4e0d\u540c\u6d4f\u89c8\u5668\u7684\u884c\u4e3a\u5408\u5e76\u4e3a\u4e00\u4e2a API,\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u786e\u4fdd\u4e8b\u4ef6\u5728\u4e0d\u540c\u6d4f\u89c8\u5668\u4e2d\u663e\u793a\u4e00\u81f4\u7684\u5c5e\u6027",source:"@site/react/06React\u4e8b\u4ef6\u673a\u5236.md",sourceDirName:".",slug:"/06React\u4e8b\u4ef6\u673a\u5236",permalink:"/website/react/06React\u4e8b\u4ef6\u673a\u5236",draft:!1,tags:[],version:"current",frontMatter:{title:"React\u7684\u4e8b\u4ef6\u673a\u5236",last_update:{date:"08/29/2024",author:"\u9ad8\u7ea2\u7fd4"}},sidebar:"tutorialSidebar",previous:{title:"react\u7684diff\u7b97\u6cd5",permalink:"/website/react/05React-diff"},next:{title:"React Hooks \u5e95\u5c42\u5b9e\u73b0",permalink:"/website/react/07React Hooks \u5e95\u5c42\u5b9e\u73b0"}},l={},c=[{value:"\u6e90\u7801\u5b9e\u73b0",id:"\u6e90\u7801\u5b9e\u73b0",level:2},{value:"1.<strong>\u6ce8\u518c\u4e8b\u4ef6\u540d</strong>",id:"1\u6ce8\u518c\u4e8b\u4ef6\u540d",level:4},{value:"2. \u7ed9<code>div#root</code>\u7ed1\u5b9a\u4e8b\u4ef6",id:"2-\u7ed9divroot\u7ed1\u5b9a\u4e8b\u4ef6",level:3},{value:"3. <strong>\u6d3e\u53d1\u4e8b\u4ef6\u5192\u6ce1\u548c\u6355\u83b7</strong>",id:"3-\u6d3e\u53d1\u4e8b\u4ef6\u5192\u6ce1\u548c\u6355\u83b7",level:4},{value:"\u6267\u884c\u5bf9\u5e94\u7684\u56de\u8c03\u51fd\u6570",id:"\u6267\u884c\u5bf9\u5e94\u7684\u56de\u8c03\u51fd\u6570",level:4},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5408\u6210\u4e8b\u4ef6\u662f\u56f4\u7ed5\u6d4f\u89c8\u5668\u539f\u751f\u4e8b\u4ef6\u5145\u5f53\u8de8\u6d4f\u89c8\u5668\u5305\u88c5\u5668\u7684\u5bf9\u8c61,\u5b83\u4eec\u5c06\u4e0d\u540c\u6d4f\u89c8\u5668\u7684\u884c\u4e3a\u5408\u5e76\u4e3a\u4e00\u4e2a API,\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u786e\u4fdd\u4e8b\u4ef6\u5728\u4e0d\u540c\u6d4f\u89c8\u5668\u4e2d\u663e\u793a\u4e00\u81f4\u7684\u5c5e\u6027\n\u4e8b\u4ef6\u90fd\u7ed1\u5b9a\u5230\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"div#root")," \u4e0a \u53ef\u4ee5\u5927\u91cf\u8282\u7701\u5185\u5b58\u5360\u7528\uff0c\u51cf\u5c11\u4e8b\u4ef6\u6ce8\u518c,\u5f53\u65b0\u589e\u5b50\u5bf9\u8c61\u65f6\u65e0\u9700\u518d\u6b21\u5bf9\u5176\u7ed1\u5b9a")),(0,r.kt)("h2",{id:"\u6e90\u7801\u5b9e\u73b0"},"\u6e90\u7801\u5b9e\u73b0"),(0,r.kt)("h4",{id:"1\u6ce8\u518c\u4e8b\u4ef6\u540d"},"1.",(0,r.kt)("strong",{parentName:"h4"},"\u6ce8\u518c\u4e8b\u4ef6\u540d")),(0,r.kt)("p",null,"\u901a\u8fc7\u63d2\u4ef6\u7cfb\u7edf\u6ce8\u518c\u4e8b\u4ef6\u540d,\u6838\u5fc3\u5c31\u662f\u7ed9 allNativeEvents \u6dfb\u52a0\u4e8b\u4ef6\u540d"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'SimpleEventPlugin.registerEvents()\n\n//\u7b80\u5355\u4e8b\u4ef6\u63d2\u4ef6\u4e8b\u4ef6\u540d\nexport const topLevelEventsToReactNames = new Map()\n\n/**\n * \u6ce8\u518c\u7b80\u5355\u4e8b\u4ef6   \u7ed9set\u91cc\u9762\u653e\u5165\u4e8b\u4ef6 map\u91cc\u9762\u505a\u6620\u5c04\n */\nexport function registerSimpleEvents() {\n  for (let i = 0; i < simpleEventPluginEvents.length; i++) {\n    const eventName = simpleEventPluginEvents[i] // click\n    const domEventName = eventName.toLowerCase() // click\n    const capitalizedEvent = eventName[0].toUpperCase() + eventName.slice(1) // Click\n    // \u5f00\u59cb\u6ce8\u518c\u7b80\u5355\u4e8b\u4ef6\n    registerSimpleEvent(domEventName, `on${capitalizedEvent}`) // click onClick\n  }\n}\n\nexport const allNativeEvents = new Set()\n/**\n * \u6ce8\u518c\u4e24\u4e2a\u9636\u6bb5\u7684\u4e8b\u4ef6 \u7ed9set\u91cc\u9762\u653e\u5165\u4e8b\u4ef6\n * \u5f53\u6211\u5728\u9875\u9762\u4e2d\u89e6\u53d1click\u4e8b\u4ef6\u7684\u65f6\u5019\uff0c\u4f1a\u8d70\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\n * \u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u9700\u8981\u627e\u5230DOM\u5143\u7d20\u5bf9\u5e94\u7684\u8981\u6267\u884cReact\u4e8b\u4ef6 onClick onClickCapture\n * @param {*} registrationName React\u4e8b\u4ef6\u540d onClick\n * @param {*} dependencies \u539f\u751f\u4e8b\u4ef6\u6570\u7ec4 [click]\n */\nexport function registerTwoPhaseEvent(registrationName, dependencies) {\n  //\u6ce8\u518c\u5192\u6ce1\u4e8b\u4ef6\n  registerDirectEvent(registrationName, dependencies)\n  //\u6ce8\u518c\u5192\u6ce1\u4e8b\u4ef6\n  registerDirectEvent(registrationName + "Capture", dependencies)\n}\n/**\n * \u6ce8\u518c\u5192\u6ce1\u4e8b\u4ef6 \u7ed9set\u91cc\u9762\u653e\u5165\u4e8b\u4ef6\n * @param {*} registrationName  React\u4e8b\u4ef6\u540d onClick\n * @param {*} dependencies \u539f\u751f\u4e8b\u4ef6\u6570\u7ec4 [click]\n */\nexport function registerDirectEvent(registrationName, dependencies) {\n  for (let i = 0; i < dependencies.length; i++) {\n    allNativeEvents.add(dependencies[i]) // click\n  }\n}\n')),(0,r.kt)("h3",{id:"2-\u7ed9divroot\u7ed1\u5b9a\u4e8b\u4ef6"},"2. \u7ed9",(0,r.kt)("inlineCode",{parentName:"h3"},"div#root"),"\u7ed1\u5b9a\u4e8b\u4ef6"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u904d\u5386\u6240\u6709\u7684\u539f\u751f\u7684\u4e8b\u4ef6\u6bd4\u5982 click,\u8fdb\u884c\u76d1\u542c"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"/**\n * \u76d1\u542c\u6240\u6709\u771f\u5b9e\u7684\u4e8b\u4ef6\n * @param {*} rootContainerElement FiberRootNode div#root\n */\nexport function listenToAllSupportedEvents(rootContainerElement) {\n  //\u76d1\u542c\u6839\u5bb9\u5668\uff0c\u4e5f\u5c31\u662fdiv#root\u53ea\u76d1\u542c\u4e00\u6b21\n  if (!rootContainerElement[listeningMarker]) {\n    // \u904d\u5386\u6240\u6709\u7684\u539f\u751f\u7684\u4e8b\u4ef6\u6bd4\u5982click,\u8fdb\u884c\u76d1\u542c\n    allNativeEvents.forEach((domEventName) => {\n      // \u6ce8\u518c\u539f\u751f\u4e8b\u4ef6 true\u6355\u83b7\n      listenToNativeEvent(domEventName, true, rootContainerElement)\n      listenToNativeEvent(domEventName, false, rootContainerElement)\n    })\n  }\n}\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u751f\u6210 dispatchEvent \u51fd\u6570\uff0c\u7ed1\u5b9a\u4e24\u4e2a\u9636\u6bb5\u7684\u4e8b\u4ef6"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"/**\n * \u589e\u52a0\u6355\u83b7\u4e8b\u4ef6\u76d1\u542c\u5668\n * @param {*} targetContainer   \u76ee\u6807DOM\u8282\u70b9 div#root \u5bb9\u5668\u8282\u70b9\n * @param {*} domEventName \u539f\u751f\u4e8b\u4ef6 click\n * @param {*} eventSystemFlags \u9ed8\u8ba4\u662f0\u6307\u7684\u662f\u5192\u6ce1  4\u662f\u6355\u83b7\n * @param {*} isCapturePhaseListener  \u662f\u5426\u662f\u6355\u83b7\u9636\u6bb5 true false\n */\nfunction addTrappedEventListener(targetContainer, domEventName, eventSystemFlags, isCapturePhaseListener) {\n  //\u521b\u5efa\u4e8b\u4ef6\u76d1\u542c\u51fd\u6570\u5305\u88f9\u5668\u5e26\u4f18\u5148\u7ea7\n  const listener = createEventListenerWrapperWithPriority(targetContainer, domEventName, eventSystemFlags)\n  if (isCapturePhaseListener) {\n    //\u589e\u52a0\u4e8b\u4ef6\u7684\u6355\u83b7\u76d1\u542c \u7ed1\u5b9a\u4e8b\u4ef6\n    addEventCaptureListener(targetContainer, domEventName, listener)\n  } else {\n    //\u589e\u52a0\u4e8b\u4ef6\u7684\u5192\u6ce1\u76d1\u542c\n    addEventBubbleListener(targetContainer, domEventName, listener)\n  }\n}\n")),(0,r.kt)("h4",{id:"3-\u6d3e\u53d1\u4e8b\u4ef6\u5192\u6ce1\u548c\u6355\u83b7"},"3. ",(0,r.kt)("strong",{parentName:"h4"},"\u6d3e\u53d1\u4e8b\u4ef6\u5192\u6ce1\u548c\u6355\u83b7")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/**\n * \u628a\u8981\u6267\u884c\u56de\u8c03\u51fd\u6570\u6dfb\u52a0\u5230dispatchQueue\u4e2d\n * @param {*} dispatchQueue \u6d3e\u53d1\u961f\u5217\uff0c\u91cc\u9762\u653e\u7f6e\u6211\u4eec\u7684\u76d1\u542c\u51fd\u6570 []\n * @param {*} domEventName DOM\u4e8b\u4ef6\u540d click\n * @param {*} targetInst \u76ee\u6807fiber\n * @param {*} nativeEvent \u539f\u751f\u4e8b\u4ef6 e\n * @param {*} nativeEventTarget \u539f\u751f\u4e8b\u4ef6\u6e90 span\n * @param {*} eventSystemFlags  \u4e8b\u4ef6\u7cfb\u7edf\u6807\u9898 0 \u8868\u793a\u5192\u6ce1 4\u8868\u793a\u6355\u83b7\n * @param {*} targetContainer  \u76ee\u6807\u5bb9\u5668 div#root\n */\nfunction extractEvents(\n  dispatchQueue,\n  domEventName,\n  targetInst,\n  nativeEvent,\n  nativeEventTarget,\n  eventSystemFlags,\n  targetContainer\n) {\n  //\u901a\u8fc7map\u6620\u5c04\u67e5\u627e\u5bf9\u5e94\u7684\u5c5e\u6027\n  const reactName = topLevelEventsToReactNames.get(domEventName) //click=>onClick\n  let SyntheticEventCtor //\u5408\u6210\u4e8b\u4ef6\u7684\u6784\u5efa\u51fd\u6570\n\n  switch (domEventName) {\n    case "click":\n      SyntheticEventCtor = SyntheticMouseEvent //\u5408\u6210\u9f20\u6807\u4e8b\u4ef6\n      break\n    default:\n      break\n  }\n  const isCapturePhase = (eventSystemFlags & IS_CAPTURE_PHASE) !== 0 //\u662f\u5426\u662f\u6355\u83b7\u9636\u6bb5\n  // \u7d2f\u52a0\u5355\u9636\u6bb5\u76d1\u542c\n  // \u8fd4\u56de\u6355\u83b7\u6216\u8005\u5192\u6ce1\u7684\u4e8b\u4ef6\u51fd\u6570\u96c6\u5408\n  const listeners = accumulateSinglePhaseListeners(targetInst, reactName, nativeEvent.type, isCapturePhase)\n  //\u5982\u679c\u6709\u8981\u6267\u884c\u7684\u76d1\u542c\u51fd\u6570\u7684\u8bdd[onClickCapture,onClickCapture]=[ChildCapture,ParentCapture]\n  if (listeners.length > 0) {\n    //\u521b\u5efa\u5408\u6210\u4e8b\u4ef6\u5b9e\u4f8b event\n    const event = new SyntheticEventCtor(reactName, domEventName, null, nativeEvent, nativeEventTarget)\n    dispatchQueue.push({\n      event, //\u5408\u6210\u4e8b\u4ef6\u5b9e\u4f8b e.target...\n      listeners, //\u76d1\u542c\u51fd\u6570\u6570\u7ec4\n    })\n  }\n}\n')),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u4e8b\u4ef6\u6e90\uff0c\u62ff\u5230\u771f\u5b9e DOM \u548c\u5bf9\u5e94\u7684 fiber")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"/**\n * \u6b64\u65b9\u6cd5\u5c31\u662f\u59d4\u6258\u7ed9\u5bb9\u5668\u7684\u56de\u8c03\uff0c\u5f53\u5bb9\u5668div#root\u5728\u6355\u83b7\u6216\u8005\u8bf4\u5192\u6ce1\u9636\u6bb5\u5904\u7406\u4e8b\u4ef6\u7684\u65f6\u5019\u4f1a\u6267\u884c\u6b64\u51fd\u6570\n * @param {*} domEventName \u4e8b\u4ef6\u540d click\n * @param {*} eventSystemFlags \u9636\u6bb5 0 \u5192\u6ce1 4 \u6355\u83b7\n * @param {*} targetContainer \u5bb9\u5668div#root\n * @param {*} nativeEvent \u539f\u751f\u7684\u4e8b\u4ef6\n */\nexport function dispatchEvent(domEventName, eventSystemFlags, targetContainer, nativeEvent) {\n  //\u83b7\u53d6\u4e8b\u4ef6\u6e90\uff0c\u5b83\u662f\u4e00\u4e2a\u771f\u5b9eDOM\n  const nativeEventTarget = getEventTarget(nativeEvent)\n  //\u4ece\u771f\u5b9e\u7684DOM\u8282\u70b9\u4e0a\u83b7\u53d6\u5b83\u5bf9\u5e94\u7684fiber\u5b9e\u4f8b\n  const targetInst = getClosestInstanceFromNode(nativeEventTarget)\n  //\u6d3e\u53d1\u4e8b\u4ef6\u4e3a\u63d2\u4ef6\u4e8b\u4ef6\u7cfb\u7edf\n  dispatchEventForPluginEventSystem(\n    domEventName, //click\n    eventSystemFlags, //0 4\n    nativeEvent, //\u539f\u751f\u4e8b\u4ef6\n    targetInst, //\u6b64\u771f\u5b9eDOM\u5bf9\u5e94\u7684fiber\n    targetContainer //\u76ee\u6807\u5bb9\u5668\n  )\n}\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u4ece\u4e8b\u4ef6\u6e90\u5411\u4e0a\u9012\u904d\u5386 fiber\uff0c\u5c06\u5bf9\u5e94\u4e8b\u4ef6\u6620\u5c04\u7684\u51fd\u6570\u6dfb\u52a0\u5230 listeners"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},'/**\n * \u7d2f\u52a0\u5355\u9636\u6bb5\u76d1\u542c\n * @param {*} targetFiber  fiber\n * @param {*} reactName onClick\n * @param {*} nativeEventType click\n * @param {*} isCapturePhase true  false\n * @returns \u8fd4\u56de\u6355\u83b7\u6216\u8005\u5192\u6ce1\u7684\u4e8b\u4ef6\u51fd\u6570\u96c6\u5408\n */\nexport function accumulateSinglePhaseListeners(targetFiber, reactName, nativeEventType, isCapturePhase) {\n  const captureName = reactName + "Capture" //onClickCapture\n  //\u6355\u83b7\u8fd8\u662f\u5192\u6ce1\n  const reactEventName = isCapturePhase ? captureName : reactName\n  const listeners = [] //\u5148\u653e\u5b50span \u7684\u4e8b\u4ef6 \u518d\u653e\u7236h1\u7684\u4e8b\u4ef6\n  let instance = targetFiber\n  while (instance !== null) {\n    const { stateNode, tag } = instance\n    if (tag === HostComponent && stateNode !== null) {\n      // \u83b7\u53d6\u5bf9\u5e94 onClickCapture \u6216\u8005 onClick\u7684\u56de\u8c03\u51fd\u6570\n      const listener = getListener(instance, reactEventName)\n      if (listener) {\n        listeners.push(createDispatchListener(instance, listener, stateNode))\n      }\n    }\n    instance = instance.return\n  }\n  return listeners\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u521b\u5efa\u5408\u6210\u4e8b\u4ef6\u5b9e\u4f8b event"),(0,r.kt)("p",{parentName:"li"},"\u4e3a\u4e86\u505a\u6d4f\u89c8\u5668\u7684\u517c\u5bb9\u5904\u7406\uff0c\u505a\u5230\u7edf\u4e00\u3002 \u5982\u91cd\u5199 preventDefault \u548c stopPropagation \u7b49"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import assign from "shared/assign"\n\nfunction functionThatReturnsTrue() {\n  return true\n}\nfunction functionThatReturnsFalse() {\n  return false\n}\nconst MouseEventInterface = {\n  clientX: 0,\n  clientY: 0,\n}\n\nfunction createSyntheticEvent(inter) {\n  /**\n   *\u5408\u6210\u4e8b\u4ef6\u7684\u57fa\u7c7b\n   * @param {*} reactName React\u5c5e\u6027\u540d onClick\n   * @param {*} reactEventType click\n   * @param {*} targetInst \u4e8b\u4ef6\u6e90\u5bf9\u5e94\u7684fiber\u5b9e\u4f8b\n   * @param {*} nativeEvent \u539f\u751f\u4e8b\u4ef6\u5bf9\u8c61 e\n   * @param {*} nativeEventTarget \u539f\u751f\u4e8b\u4ef6\u6e90 span \u4e8b\u4ef6\u6e90\u5bf9\u5e94\u7684\u90a3\u4e2a\u771f\u5b9eDOM\n   */\n  function SyntheticBaseEvent(reactName, reactEventType, targetInst, nativeEvent, nativeEventTarget) {\n    this._reactName = reactName\n    this.type = reactEventType\n    this._targetInst = targetInst\n    this.nativeEvent = nativeEvent\n    this.target = nativeEventTarget\n    //\u628a\u6b64\u63a5\u53e3\u4e0a\u5bf9\u5e94\u7684\u5c5e\u6027\u4ece\u539f\u751f\u4e8b\u4ef6\u4e0a\u62f7\u8d1d\u5230\u5408\u6210\u4e8b\u4ef6\u5b9e\u4f8b\u4e0a\n    for (const propName in inter) {\n      if (!inter.hasOwnProperty(propName)) {\n        continue\n      }\n      //this.clientX = e. clientX\n      //this.clientY = e. clientY\n      this[propName] = nativeEvent[propName]\n    }\n    //\u662f\u5426\u5df2\u7ecf\u963b\u6b62\u9ed8\u8ba4\u4e8b\u4ef6\n    this.isDefaultPrevented = functionThatReturnsFalse\n    //\u662f\u5426\u5df2\u7ecf\u963b\u6b62\u7ee7\u7eed\u4f20\u64ad\n    this.isPropagationStopped = functionThatReturnsFalse\n    return this\n  }\n  assign(SyntheticBaseEvent.prototype, {\n    preventDefault() {\n      const event = this.nativeEvent\n      if (event.preventDefault) {\n        event.preventDefault()\n      } else {\n        event.returnValue = false\n      }\n      this.isDefaultPrevented = functionThatReturnsTrue\n    },\n    stopPropagation() {\n      const event = this.nativeEvent\n      if (event.stopPropagation) {\n        event.stopPropagation()\n      } else {\n        event.cancelBubble = true\n      }\n      this.isPropagationStopped = functionThatReturnsTrue\n    },\n  })\n  return SyntheticBaseEvent\n}\nexport const SyntheticMouseEvent = createSyntheticEvent(MouseEventInterface)\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u5c06\u5bf9\u5e94\u7684\u5408\u6210\u4e8b\u4ef6\u548c\u51fd\u6570\u6dfb\u52a0\u5230 dispatchQueue"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"dispatchQueue.push({\n  event, //\u5408\u6210\u4e8b\u4ef6\u5b9e\u4f8b e.target...\n  listeners, //\u76d1\u542c\u51fd\u6570\u6570\u7ec4\n})\n")))),(0,r.kt)("h4",{id:"\u6267\u884c\u5bf9\u5e94\u7684\u56de\u8c03\u51fd\u6570"},"\u6267\u884c\u5bf9\u5e94\u7684\u56de\u8c03\u51fd\u6570"),(0,r.kt)("p",null,"\u904d\u5386 dispatchQueue \u6267\u884c listeners \u91cc\u9762\u7684\u51fd\u6570 \u533a\u5206\u5192\u6ce1\u548c\u6355\u83b7"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"/**\n * \u6267\u884c\u56de\u8c03\u51fd\u6570\n * @param {*} dispatchQueue  \u8c03\u5ea6\u961f\u5217\n * @param {*} eventSystemFlags  \u5192\u6ce1\u6355\u83b7\u6807\u8bc6\n */\nfunction processDispatchQueue(dispatchQueue, eventSystemFlags) {\n  //\u5224\u65ad\u662f\u5426\u5728\u6355\u83b7\u9636\u6bb5  0 \u5192\u6ce1 4 \u6355\u83b7\n  const inCapturePhase = (eventSystemFlags & IS_CAPTURE_PHASE) !== 0\n  for (let i = 0; i < dispatchQueue.length; i++) {\n    const { event, listeners } = dispatchQueue[i]\n    //\u987a\u5e8f\u8c03\u5ea6\n    processDispatchQueueItemsInOrder(event, listeners, inCapturePhase)\n  }\n}\n\n/**\n * \u987a\u5e8f\u8c03\u5ea6\n * @param {*} event e span\n * @param {*} dispatchListeners [fn]\n * @param {*} inCapturePhase true false\n * @returns\n */\nfunction processDispatchQueueItemsInOrder(event, dispatchListeners, inCapturePhase) {\n  if (inCapturePhase) {\n    //dispatchListeners[\u5b50\uff0c\u7236]\n    for (let i = dispatchListeners.length - 1; i >= 0; i--) {\n      const { listener, currentTarget } = dispatchListeners[i]\n      if (event.isPropagationStopped()) {\n        return\n      }\n      //\u6267\u884cdispatch\n      executeDispatch(event, listener, currentTarget)\n    }\n  } else {\n    for (let i = 0; i < dispatchListeners.length; i++) {\n      const { listener, currentTarget } = dispatchListeners[i]\n      if (event.isPropagationStopped()) {\n        return\n      }\n      //\u6267\u884cdispatch\n      executeDispatch(event, listener, currentTarget)\n    }\n  }\n}\n/**\n * \u6267\u884cdispatch\n * @param {*} event\n * @param {*} listener\n * @param {*} currentTarget\n */\nfunction executeDispatch(event, listener, currentTarget) {\n  //\u5408\u6210\u4e8b\u4ef6\u5b9e\u4f8bcurrentTarget\u662f\u5728\u4e0d\u65ad\u7684\u53d8\u5316\u7684\n  // event nativeEventTarget \u5b83\u7684\u662f\u539f\u59cb\u7684\u4e8b\u4ef6\u6e90\uff0c\u662f\u6c38\u8fdc\u4e0d\u53d8\u7684\n  // event currentTarget \u5f53\u524d\u7684\u4e8b\u4ef6\u6e90\uff0c\u5b83\u662f\u4f1a\u968f\u7740\u4e8b\u4ef6\u56de\u8c03\u7684\u6267\u884c\u4e0d\u65ad\u53d8\u5316\u7684\n  event.currentTarget = currentTarget\n  listener(event)\n}\n")),(0,r.kt)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u63d2\u4ef6\u7cfb\u7edf\u6ce8\u518c\u4e8b\u4ef6\u540d"),(0,r.kt)("li",{parentName:"ul"},"\u7ed9",(0,r.kt)("inlineCode",{parentName:"li"},"div#root"),"\u7ed1\u5b9a\u4e8b\u4ef6",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u904d\u5386\u6240\u6709\u7684\u539f\u751f\u7684\u4e8b\u4ef6\u6bd4\u5982 click,\u8fdb\u884c\u76d1\u542c"),(0,r.kt)("li",{parentName:"ul"},"\u751f\u6210 dispatchEvent \u51fd\u6570\uff0c\u7ed1\u5b9a\u4e24\u4e2a\u9636\u6bb5\u7684\u4e8b\u4ef6"))),(0,r.kt)("li",{parentName:"ul"},"\u6d3e\u53d1\u4e8b\u4ef6\u5192\u6ce1\u548c\u6355\u83b7\uff08\u70b9\u51fb\u4e8b\u4ef6\u6e90\uff09",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u83b7\u53d6\u4e8b\u4ef6\u6e90\uff0c\u62ff\u5230\u771f\u5b9e DOM \u548c\u5bf9\u5e94\u7684 fiber"),(0,r.kt)("li",{parentName:"ul"},"\u4ece\u4e8b\u4ef6\u6e90\u5411\u4e0a\u9012\u904d\u5386 fiber\uff0c\u5c06\u5bf9\u5e94\u4e8b\u4ef6\u6620\u5c04\u7684\u51fd\u6570\u6dfb\u52a0\u5230 listeners"),(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u5408\u6210\u4e8b\u4ef6\u5b9e\u4f8b\uff0c\u517c\u5bb9\u5904\u7406"),(0,r.kt)("li",{parentName:"ul"},"\u5c06\u5bf9\u5e94\u7684\u5408\u6210\u4e8b\u4ef6\u548c\u51fd\u6570\u6dfb\u52a0\u5230 dispatchQueue"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u533a\u5206\u5192\u6ce1\u548c\u6355\u83b7 \u6267\u884c\u5bf9\u5e94\u7684\u56de\u8c03\u51fd\u6570"))))}u.isMDXComponent=!0}}]);