"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6074],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>m});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var i=r.createContext({}),p=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},f=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,l=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),f=p(t),m=o,g=f["".concat(i,".").concat(m)]||f[m]||u[m]||l;return t?r.createElement(g,a(a({ref:n},c),{},{components:t})):r.createElement(g,a({ref:n},c))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var l=t.length,a=new Array(l);a[0]=f;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var p=2;p<l;p++)a[p]=t[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}f.displayName="MDXCreateElement"},6593:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var r=t(7462),o=(t(7294),t(3905));const l={title:"9. Node \u6838\u2f3c\u5185\u5bb9",last_update:{date:"02/14/2023",author:"\u9ad8\u7ea2\u7fd4"}},a="Node \u6838\u2f3c\u5185\u5bb9",s={unversionedId:"09\u5168\u5c40\u5bf9\u8c61",id:"09\u5168\u5c40\u5bf9\u8c61",title:"9. Node \u6838\u2f3c\u5185\u5bb9",description:"\u5728 Node.js \u4e2d\uff0c\u5168\u5c40\u5bf9\u8c61\u662f global \u5bf9\u8c61\u3002\u5168\u5c40\u5bf9\u8c61\u4e0a\u7684\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\uff0c\u4f46\u662f\u5728\u6a21\u5757\u4e2d\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\uff0cexports\u3001require\u3001module\u3001filename\u3001dirname\uff0c\u5747\u4e3a\u51fd\u6570\u7684\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6a21\u5757\u5185\u90e8\u76f4\u63a5\u8bbf\u95ee\u8fd9\u4e9b\u53d8\u91cf\uff0c\u4f46\u662f\u5b83\u4eec\u5e76\u4e0d\u662f\u5168\u5c40\u5bf9\u8c61\u4e0a\u7684\u5c5e\u6027\u3002",source:"@site/node/09\u5168\u5c40\u5bf9\u8c61.md",sourceDirName:".",slug:"/09\u5168\u5c40\u5bf9\u8c61",permalink:"/website/node/09\u5168\u5c40\u5bf9\u8c61",draft:!1,tags:[],version:"current",frontMatter:{title:"9. Node \u6838\u2f3c\u5185\u5bb9",last_update:{date:"02/14/2023",author:"\u9ad8\u7ea2\u7fd4"}},sidebar:"tutorialSidebar",previous:{title:"8. npm \u7684\u4f7f\u2f64",permalink:"/website/node/08npm\u7684\u4f7f\u7528"},next:{title:"10.PromisesA+\u89c4\u8303",permalink:"/website/node/10PromisesA+\u89c4\u8303"}},i={},p=[{value:"<strong>1.Global</strong>",id:"1global",level:2},{value:"<strong>2.Process</strong>",id:"2process",level:2},{value:"<strong>3.Node</strong>\u4e2d\u7684\u4e8b\u4ef6\u73af",id:"3node\u4e2d\u7684\u4e8b\u4ef6\u73af",level:2},{value:"<strong>\u6267\u884c\u6d41\u7a0b</strong>",id:"\u6267\u884c\u6d41\u7a0b",level:3},{value:"<strong>4.Buffer</strong>",id:"4buffer",level:2},{value:"<strong>1).</strong>\u4e3a\u4ec0\u4e48\u9700\u8981 Buffer?",id:"1\u4e3a\u4ec0\u4e48\u9700\u8981-buffer",level:3},{value:"<strong>2).</strong>\u8fdb\u5236\u8f6c\u6362",id:"2\u8fdb\u5236\u8f6c\u6362",level:3},{value:"3).\u5b57\u7b26\u7f16\u7801",id:"3\u5b57\u7b26\u7f16\u7801",level:3},{value:"4).base64 \u7f16\u7801",id:"4base64-\u7f16\u7801",level:3},{value:"<strong>5 . Buffer \u7684\u4f7f\u2f64</strong>",id:"5--buffer-\u7684\u4f7f",level:2},{value:"1).buffer \u7684\u58f0\u660e\u2f45\u5f0f",id:"1buffer-\u7684\u58f0\u660e\u5f0f",level:3},{value:"<strong>2).buffer.copy</strong>",id:"2buffercopy",level:3},{value:"<strong>3).Buffer.concat</strong>",id:"3bufferconcat",level:3},{value:"<strong>4).buffer.split</strong>",id:"4buffersplit",level:3},{value:"6.path \u6a21\u5757",id:"6path-\u6a21\u5757",level:2},{value:"7.events \u6a21\u5757",id:"7events-\u6a21\u5757",level:2},{value:"\u53d1\u5e03\u8ba2\u9605",id:"\u53d1\u5e03\u8ba2\u9605",level:3},{value:"<strong>8</strong>.fs<strong>\u6a21\u5757</strong>",id:"8fs\u6a21\u5757",level:2},{value:"<strong>1).readFile</strong>\u3001<strong>writeFile</strong>",id:"1readfilewritefile",level:3},{value:"<strong>2).</strong>\u2f3f\u52a8\u8bfb\u53d6",id:"2\u52a8\u8bfb\u53d6",level:3},{value:"<strong>3).</strong>\u9012\u5f52\u62f7\u2ec9",id:"3\u9012\u5f52\u62f7",level:3},{value:"<strong>4).</strong>\u2f42\u4ef6\u6d41\u5b9e\u73b0\u62f7\u2ec9",id:"4\u4ef6\u6d41\u5b9e\u73b0\u62f7",level:3},{value:"<strong>5)</strong>.<strong>\u53ef\u8bfb\u6d41</strong>",id:"5\u53ef\u8bfb\u6d41",level:3}],c={toc:p};function u(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"node-\u6838\u5185\u5bb9"},"Node \u6838\u2f3c\u5185\u5bb9"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5728 Node.js \u4e2d\uff0c\u5168\u5c40\u5bf9\u8c61\u662f global \u5bf9\u8c61\u3002\u5168\u5c40\u5bf9\u8c61\u4e0a\u7684\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\uff0c\u4f46\u662f\u5728\u6a21\u5757\u4e2d\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\uff0cexports\u3001require\u3001module\u3001",(0,o.kt)("strong",{parentName:"p"},"filename\u3001"),"dirname\uff0c\u5747\u4e3a\u51fd\u6570\u7684\u53c2\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6a21\u5757\u5185\u90e8\u76f4\u63a5\u8bbf\u95ee\u8fd9\u4e9b\u53d8\u91cf\uff0c\u4f46\u662f\u5b83\u4eec\u5e76\u4e0d\u662f\u5168\u5c40\u5bf9\u8c61\u4e0a\u7684\u5c5e\u6027\u3002")),(0,o.kt)("h2",{id:"1global"},(0,o.kt)("strong",{parentName:"h2"},"1.Global")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"node \u4e2d\u7684\u5168\u5c40\u5bf9\u8c61 global , this \u4e0d\u662f global\uff0c\u6307\u4ee3\u7684\u662f\u5f53\u524d\u6a21\u5757\u7684\u5bfc\u51fa\u5bf9\u8c61.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u5728 Node.js \u4e2d\uff0c\u901a\u8fc7\u5728\u53d8\u91cf\u524d\u2faf\u52a0\u4e0a global \u5173\u952e\u5b57\u6765\u58f0\u660e\u5168\u5c40\u53d8\u91cf\u3002")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u901a\u8fc7 var \u58f0\u660e\u7684\u53d8\u91cf\u4e0d\u4f1a\u6302\u8f7d\u5230\u5168\u5c40\u4e0a\u3002")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u5168\u5c40\u53d8\u91cf\u53ef\u4ee5\u518d\u4e0d\u540c\u6a21\u5757\u4e2d\u8fdb\u2f8f\u8bbf\u95ee\u3002")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u4e0d\u5efa\u8bae\u5728\u4ee3\u7801\u4e2d\u4f7f\u2f64\u5168\u5c40\u53d8\u91cf\uff0c\u4f1a\u6c61\u67d3\u5168\u5c40\u73af\u5883\u3002"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u5168\u5c40\u5c5e\u6027"),"\uff0c \u53ef\u4ee5\u901a\u8fc7 global \u76f4\u63a5\u8bbf\u95ee \uff08\u53ef\u4ee5\u4e0d\u518d\u6a21\u5757\u5185\u88ab\u8bbf\u95ee\uff09"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"process")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"setImmediate")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"setTimeout")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Buffer"))),(0,o.kt)("h2",{id:"2process"},(0,o.kt)("strong",{parentName:"h2"},"2.Process")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"process.cwd"),": \u5f53\u524d\u7684\u5de5\u4f5c\u76ee\u5f55, \u4f1a\u6839\u636e\u6267\u884c\u6587\u4ef6\u7684\u4f4d\u7f6e\u53d1\u751f\u53d8\u5316 \u5c3d\u91cf\u8bfb\u53d6\u6587\u4ef6\u91c7\u7528\u7edd\u5bf9\u8def\u5f84 ",(0,o.kt)("inlineCode",{parentName:"p"},"__dirname")," \u4e0d\u80fd\u53d8")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"process.platform"),": \u5e73\u53f0\u6807\u8bc6 win32 \u548c darwin")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"process.env.NODE_ENV"),": \u73af\u5883\u53d8\u91cf\uff0c\u901a\u8fc7 cross-env \u53ef\u4ee5\u8bbe\u7f6e\u4e0d\u540c\u5e73\u53f0\u7684\u73af\u5883\u53d8\u91cf\u3002\uff08\u7ec8\u7aef\u73af\u5883\u53d8\u91cf ",(0,o.kt)("inlineCode",{parentName:"p"},"export NODE_ENV=dev"),"\u3001\u7cfb\u7edf\u73af\u5883\u53d8\u91cf",(0,o.kt)("inlineCode",{parentName:"p"},"~/.bash_profile"),"\uff09"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'console.log(process.env.NODE_ENV)\nlet url = ""\nif (process.env.NODE_ENV == "dev") {\n  url = "http://localhost:3000"\n} else {\n  url = "http://xxx.cn"\n}\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"process.argv"),":\u83b7\u53d6\u2f64\u6237\u4f20\u9012\u7684\u53c2\u6570")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"webpack --config webpack.config.js --port 3000 --hot\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"argv")," \u524d\u4e24\u4e2a\u53c2\u6570\u4e00\u822c\u7528\u4e0d\u5230"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"node \u7684\u53ef\u6267\u884c\u6587\u4ef6")),(0,o.kt)("p",null,"2) \u5f53\u524d\u8981\u6267\u884c\u7684\u6587\u4ef6"),(0,o.kt)("p",null,"\u4e00\u822c\u60c5\u51b5\u4e0b\u53c2\u6570\u7684\u77ed\u5199 -p \u957f\u4e9b--port \u503c\u4e0d\u7528-\uff0ckey \u5f97\u7528-"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"console.log(process.argv)\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u8f6c\u6362\u6210\u5bf9\u8c61")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'let args = process.argv.slice(2).reduce((memo, current, index, array) => {\n  if (current.startsWith("--")) {\n    memo[current.slice(2)] = array[index + 1]\n      ? array[index + 1].startsWith("--")\n        ? true\n        : array[index + 1]\n      : true\n  }\n  return memo\n}, {})\nconsole.log(args)\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u7b2c\u4e09\u2f45\u6a21\u5757\u53ef\u4ee5\u6765\u5b9e\u73b0\u8fd9\u4e9b\u529f\u80fd commander\uff0cyargs\uff0cminimist")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const { program } = require("commander")\nconst pkg = require("./package.json")\nprogram.name("my-cli") // \u53d1\u5e03\u7684\u547d\u4ee4\u540d\u5b57\nprogram.usage("<command> [options]") // \u4f7f\u2f64\u2f45\u5f0f\nprogram.version(pkg.version)\nprogram\n  .command("create") // \u521b\u5efa\u9879\u2f6c\n  .description("create directory") // \u63cf\u8ff0\n  .option("-d, --directory <d>", "createproject directory") // \u53c2\u6570\n  .action((args) => {\n    // \u6267\u2f8f\u7684\u52a8\u4f5c\n    console.log(args)\n  })\n  .on("--help", () => {\n    console.log("create project~~~")\n  })\nprogram\n  .command("serve") // \u542f\u52a8\u670d\u52a1\n  .description("starrt server")\n  .option("-p, --port [p]", "serverport", 3000)\n  .action((args) => {\n    console.log(args)\n  })\nprogram.on("--help", function () {\n  console.log("\\n Run my-cli <command> --help.")\n})\nprogram.parse()\n')),(0,o.kt)("h2",{id:"3node\u4e2d\u7684\u4e8b\u4ef6\u73af"},(0,o.kt)("strong",{parentName:"h2"},"3.Node"),"\u4e2d\u7684\u4e8b\u4ef6\u73af"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/ghx9908/image-hosting/master/img/20230213114421.png",alt:null})),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u6211\u4eec\u5199\u7684 js \u4ee3\u7801\u4f1a\u4ea4\u7ed9 v8 \u5f15\u64ce\u8fdb\u2f8f\u5904\u7406")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u4ee3\u7801\u4e2d\u53ef\u80fd\u4f1a\u8c03\u2f64 nodeApi,node \u4f1a\u4ea4\u7ed9 libuv \u5e93\u5904\u7406")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"libuv \u901a\u8fc7\u963b\u585e i/o \u548c\u591a\u7ebf\u7a0b\u5b9e\u73b0\u4e86\u5f02\u6b65 io")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u901a\u8fc7\u4e8b\u4ef6\u9a71\u52a8\u7684\u2f45\u5f0f,\u5c06\u7ed3\u679c\u653e\u5230\u4e8b\u4ef6\u961f\u5217\u4e2d,\u6700\u7ec8\u4ea4\u7ed9\u6211\u4eec\u7684\u5e94\u2f64\u3002"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"\u672c\u9636\u6bb5\u6267\u2f8f\u5df2\u7ecf\u88ab setTimeout() \u548c setInterval()\u7684\u8c03\u5ea6\u56de\u8c03\u51fd\u6570\u3002\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u250c\u2500>\u2502           timers          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n|          \u6267\u2f8f\u5ef6\u8fdf\u5230\u4e0b\u2f00\u4e2a\u5faa\u73af\u8fed\u4ee3\u7684 I/O \u56de\u8c03\u3002\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u2502     pending callbacks     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n|         \u4ec5\u7cfb\u7edf\u5185\u90e8\u4f7f\u2f64\u3002\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u2502       idle, prepare       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n| \u68c0\u7d22\u65b0\u7684I/O\u4e8b\u4ef6;\u6267\u2f8f\u4e0e I/O\u76f8\u5173\u7684\u56de\u8c03     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502   incoming:   \u2502\n\u2502  \u2502           poll            \u2502<\u2500\u2500\u2500\u2500\u2500\u2524  connections, \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502   data, etc.  \u2502\n|   setImmediate() \u56de\u8c03\u51fd\u6570\u5728\u8fd9\u2fa5\u6267\u2f8f\u3002  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \u2502           check           \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n|       \u2f00\u4e9b\u5173\u95ed\u7684\u56de\u8c03\u51fd\u6570\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2514\u2500\u2500\u2524      close callbacks      \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n")),(0,o.kt)("p",null,"\u8fd9\u2fa5\u6bcf\u2f00\u4e2a\u9636\u6bb5\u90fd\u5bf9\u5e94\u2f00\u4e2a\u4e8b\u4ef6\u961f\u5217,\u5f53 event loop \u6267\u2f8f\u5230\u67d0\u4e2a\u9636\u6bb5\u65f6\u4f1a\u5c06\u5f53\u524d\u9636\u6bb5\u5bf9\u5e94\u7684\u961f\u5217\u4f9d\u6b21\u6267\u2f8f\u3002\u5f53\u8be5\u961f\u5217\u5df2\u2f64\u5c3d\u6216\u8fbe\u5230\u56de\u8c03\u9650\u5236\uff0c\u4e8b\u4ef6\u5faa\u73af\u5c06\u79fb\u52a8\u5230\u4e0b\u2f00\u9636\u6bb5\u3002"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"process.nextTick() \u4ece\u6280\u672f\u4e0a\u8bb2\u4e0d\u662f\u4e8b\u4ef6\u5faa\u73af\u7684\u2f00\u90e8\u5206\u3002\u4f18\u5148\u7ea7\u2fbc\u4e8e\u5fae\u4efb\u52a1")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u6d4f\u89c8\u5668\uff1a\u6bcf\u6267\u884c\u5b8c\u6bd5\u4e00\u4e2a\u5b8f\u4efb\u52a1\uff0c\u4f1a\u6e05\u7a7a\u5fae\u4efb\u52a1 \u4ece node10+ \u540e\u6267\u884c\u673a\u5236\u548c\u6211\u4eec\u7684\u6d4f\u89c8\u5668\u4e00\u6837 \u65b0\u7684"),(0,o.kt)("p",{parentName:"blockquote"},"\u4ee5\u524d\u7684 node \u4e8b\u4ef6\u73af\u662f\u6bcf\u4e2a\u9636\u6bb5\u7684\u5b8f\u4efb\u52a1\u90fd\u88ab\u6e05\u7a7a\u4e86\uff0c\u624d\u4f1a\u6267\u884c\u5fae\u4efb\u52a1 \u8001\u7684")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u5b8f\u4efb\u52a1"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"timers \u961f\u5217 \u7528\u6765\u653e\u5b9a\u65f6\u5668"),(0,o.kt)("li",{parentName:"ul"},"poll \u8f6e\u8bad\uff08\u5904\u7406 i/o \u7684\u56de\u8c03\uff09"),(0,o.kt)("li",{parentName:"ul"},"check \u5904\u7406 setImmediate"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u5fae\u4efb\u52a1\uff1aprocess.nextTick > promise.then"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-JS"},"Promise.resolve().then(()=>{\n    console.log('promise')\n})\n\nprocess.nextTick(()=>{ // \u8fd9\u4e2a\u65b9\u6cd5\u7528\u7684\u591a\u4e00\u4e9b\n    console.log('nextTick')\n})\n")),(0,o.kt)("h3",{id:"\u6267\u884c\u6d41\u7a0b"},(0,o.kt)("strong",{parentName:"h3"},"\u6267\u884c\u6d41\u7a0b")),(0,o.kt)("p",null,"\u4e3b\u6808\u4ee3\u7801\u6267\u884c\u5b8c\u6bd5-\u300b\u4f1a\u68c0\u6d4b timer \u4e2d\u6709\u6ca1\u6709\u56de\u8c03\uff0c\u5168\u90e8\u6e05\u7a7a\u540e\u8fdb\u5165\u5230\u4e0b\u4e00\u4e2a\u9636\u6bb5 -\u300bpoll\uff08\u6709 i/o \u7684\u56de\u8c03\u7ee7\u7eed\u5904\u7406\uff09-> \u770b\u6709\u6ca1\u6709 check,\u5982\u679c\u6709\u5c31\u6e05\u7a7a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u9ed8\u8ba4\u5982\u679c\u6ca1\u6709 check \u4e5f\u6ca1\u6709 timer\uff0c\u4ee3\u7801\u903b\u8f91\u8fd8\u6709\u6ca1\u6267\u884c\u5b8c\u7684\u56de\u8c03\uff0c\u6b64\u65f6\u8fd9\u4e2a\u7ebf\u7a0b\u4f1a\u5728 poll \u4e2d\u7b49\u5f85")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u5982\u679c\u6ca1\u6709 timer -\u300b poll\uff08\u6709 i/o \u7684\u56de\u8c03\u7ee7\u7eed\u5904\u7406\uff09-\u300b \u6ca1\u6709 check \u4e86"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"poll \u9636\u6bb5:")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u68c0\u6d4b Poll \u961f\u5217\u4e2d\u662f\u5426\u4e3a\u7a7a\uff0c\u5982\u679c\u4e0d\u4e3a\u7a7a\u5219\u6267\u2f8f\u961f\u5217\u4e2d\u7684\u4efb\u52a1\uff0c\u76f4\u5230\u8d85\u65f6\u6216\u8005\u5168\u90e8\u6267\u2f8f\u5b8c\u6bd5\u3002")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u6267\u2f8f\u5b8c\u6bd5\u540e\u68c0\u6d4b setImmediate \u961f\u5217\u662f\u5426\u4e3a\u7a7a\uff0c\u5982\u679c\u4e0d\u4e3a\u7a7a\u5219\u6267\u2f8f check \u9636\u6bb5\uff0c\u5982\u679c\u4e3a\u7a7a\u5219\u7b49\u5f85\u65f6\u95f4\u5230\u8fbe\u3002\u65f6\u95f4\u5230\u8fbe\u540e\u56de\u5230 timer \u9636\u6bb5")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u7b49\u5f85\u65f6\u95f4\u5230\u8fbe\u65f6\u53ef\u80fd\u4f1a\u51fa\u73b0\u65b0\u7684 callback\uff0c\u6b64\u65f6\u4e5f\u5728\u5f53\u524d\u9636\u6bb5\u88ab\u6e05\u7a7a"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-JS"},"setTimeout(() => { // \u6267\u2f8f\u987a\u5e8f\u4e0d\u786e\u5b9a\nconsole.log('settimeout')\n})\nsetImmediate(() => {\nconsole.log('check')\n})\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-JS"},"const fs = require('fs');\nfs.readFile('./package.json', () => { // poll\u9636\u6bb5\u7684\u4e0b\u2f00\u4e2a\u9636\u6bb5\u662fcheck\nsetTimeout(() => { // timer\nconsole.log('settimeout')\n })\nsetImmediate(() => { // check\nconsole.log('check')\n })\n});\n")),(0,o.kt)("h2",{id:"4buffer"},(0,o.kt)("strong",{parentName:"h2"},"4.Buffer")),(0,o.kt)("h3",{id:"1\u4e3a\u4ec0\u4e48\u9700\u8981-buffer"},(0,o.kt)("strong",{parentName:"h3"},"1)."),"\u4e3a\u4ec0\u4e48\u9700\u8981 Buffer?"),(0,o.kt)("p",null,"Buffer \u5bf9\u8c61\u5728 Node.js \u4e2d\u662f\u2f64\u6765\u5904\u7406\u2f06\u8fdb\u5236\u6570\u636e\u7684\uff0c\u5c55\u73b0\u5f62\u5f0f\u662f 16 \u8fdb\u5236\u3002\u6709\u4e86 Buffer \u4e4b\u540e\u8ba9 js \u62e5\u6709\u5904\u7406\u2f06\u8fdb\u5236\u6570\u636e\u7684\u80fd\u2f12\u3002\uff08Blob \u4e0d\u80fd\u5bf9\u2f42\u4ef6\u8fdb\u2f8f\u5904\u7406\uff0cArrayBuffer \u4e0d\u80fd\u76f4\u63a5\u8bfb\u53d6\u2f06\u8fdb\u5236\u6570\u636e\uff0cbuffer \u76f4\u63a5\u53ef\u4ee5\u5904\u7406\u2f06\u8fdb\u5236\u6570\u636e\uff09"),(0,o.kt)("h3",{id:"2\u8fdb\u5236\u8f6c\u6362"},(0,o.kt)("strong",{parentName:"h3"},"2)."),"\u8fdb\u5236\u8f6c\u6362"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u4e8c\u8fdb\u5236 0b \u5f00\u5934 \u516b\u8fdb\u5236 0 \u5f00\u5934 \u5341\u516d\u8fdb\u5236 0x \u5f00\u5934")),(0,o.kt)("p",null,"\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u5b57\u8282\uff0c\u4e5f\u5c31\u662f 1b\uff0c 1b = 1bit(\u6bcf\u4e00\u4e2a\u4f4d\u53ef\u4ee5\u5b58\u50a8 0 \u6216\u8005 1 1024b = 1kb 1024kb = 1M"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u4efb\u610f\u8fdb\u5236\u8f6c\u6362\u6210 10 \u8fdb\u5236 \u91c7\u2f64",(0,o.kt)("strong",{parentName:"li"},"\u4e58\u6743\u6c42\u548c"),"\u7684\u2f45\u5f0f parseInt('0111',2)")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'// 111 \u662f\u4e8c\u8fdb\u5236 -\u300b3 10\u8fdb\u5236  1x2^2 + 1x2^1 + 1*2^0 -> 7\n// 111 \u662f16\u8fdb\u5236 -\u300b17 10\u8fdb\u5236\n// \u4e58\u6743\u6c42\u548c   1 * 16 ^2 + 1 * 16 ^1 + 1 * 16 ^0 = 273\n// 1111111111 + 1 -1 = 1 * 2 ^ 10 -1\nconsole.log(parseInt("1111111111", 2)) // \u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5c06\u4efb\u4f55\u8fdb\u5236\u8f6c\u5316\u621010\u8fdb\u5236\n// toString \u53ef\u4ee5\u8f6c\u6362\u4efb\u4f55\u8fdb\u5236 \u8f6c\u51fa\u6765\u7684\u662f\u5b57\u7b26\u4e32\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"10 \u8fdb\u5236\u8f6c\u4efb\u610f\u8fdb\u5236 \u91c7\u2f64",(0,o.kt)("strong",{parentName:"li"},"\u53cd\u5411\u53d6\u4f59"),"\u7684\u2f45\u5f0f(100).toString(16)")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u53cd\u5411\u53d6\u4f59\u7684\u65b9\u5f0f\u6765\u8ba1\u7b97\n// 100 -> 16  -> 64\n\nconsole\n  .log((100).toString(16))(\n    // 64\n\n    0x11\n  )\n  .toString(2) //'10001'\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"10 \u8fdb\u5236\u2f29\u6570\u8f6c\u2f06\u8fdb\u5236 \u91c7\u2f64",(0,o.kt)("strong",{parentName:"li"},"\u4e58\u53d6 2 \u6574\u6cd5"),"\u7684\u2f45\u5f0f (0.1).toString(2)")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u601d\u8003\uff1a0.1 + 0.2 !== 0.3")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// 0.1 + 0.2 !== 0.3  -> \u4e8c\u8fdb\u5236\u6765\u5b58\u50a8  10\u8fdb\u5236\u7684\u5c0f\u6570\u5982\u4f55\u8f6c\u5316\u62102\u8fdb\u5236\n// \u4e582\u53d6\u6574\u6cd5\n// 0.1 * 2 = 0.2\n// 0.2 * 2 = 0.4\n// 0.4 * 2 = 0.8\n// 0.8 * 2 = 1.6\n// 0.6 * 2 = 1.2\n// 0.2 * 2 = 0.4\n// 0.00011001001001001\nconsole.log((0.1).toString(2)) //'0.0001100110011001100110011001100110011001100110011001101'\nconsole.log(0.1 + 0.2) // 0.30000000000000004\nconsole.log(0.2 + 0.2) // \u90fd\u662f\u8fd1\u4f3c\u503c  0.4\n")),(0,o.kt)("h3",{id:"3\u5b57\u7b26\u7f16\u7801"},"3).\u5b57\u7b26\u7f16\u7801"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"ASCII\uff1a\u6700\u65e9\u91c7\u2f64 ASCII\uff0c\u662f\u2f00\u79cd 7 \u4f4d\u7684\u7f16\u7801\u2f45\u5f0f\uff0c\u6700\u591a\u2f40\u6301 128 \u4e2a\u5b57\u7b26\uff08\u53ea\u80fd\u5904\u7406\u82f1\u2f42\u5b57\u7b26\u548c\u2f00\u4e9b\u5e38\u2f64\u7684\u7b26\u53f7\uff09")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"GB2312\uff08\u56fd\u6807\u5b57\u4f53\uff09\uff1a\u7b80\u4f53\u4e2d\u2f42\u5b57\u7b26\u7f16\u7801\uff0c\u4e24\u4e2a\u5b57\u8282\u8868\u793a\uff08 \u4e24\u4e2a\u2f24\u4e8e 127 \u7684\u5b57\u7b26\u8fde\u5728\u2f00\u8d77\u65f6\uff0c\u5c31\u8868\u793a\u2f00\u4e2a\u6c49\u5b57\uff09 \u4e3a\u4e2d\u56fd\u2f7d\u2f63\uff0c\u2f24\u6982\u2f40\u6301 6000 \u591a\u4e2a\u6c49\u5b57\u3002\uff08255-127\uff09","*","(255-127)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"GBK \u53cc\u5b57\u8282 \u53ea\u8981\u7b2c\u4e00\u4e2a\u5b57\u8282\u8d85\u8fc7\u4e86 127 \u6211\u5c31\u8ba4\u4e3a\u4e0b\u4e00\u4e2a\u5b57\u8282\u5c31\u662f\u6c49\u5b57\u7684\u53e6\u4e00\u4e2a\u90e8\u5206 \u7e41\u4f53\u3002\u2f40\u6301\u4e86\u7e41\u4f53\u3001\u2f47\u8bed\u3001\u97e9\u8bed\u7b49(\uff08255\uff09","*","(255-127)) \u534a\u89d2\u548c\u5168\u89d2\u95ee\u9898")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"GB18030 \u5728 GB2312 \u548c GBK \u57fa\u7840\u4e0a\u66f4\u5168\u2faf")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Unicode \u4f7f\u2f64 16 \u4f4d\u6765\u7edf\u2f00\u8868\u793a\u6240\u6709\u7684\u5b57\u7b26 \uff08\u5c06\u2f42\u5b57\u5168\u90e8\u91cd\u5199\u91cd\u62cd\uff09 \uff08255","*","255\uff09")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"UTF-8 \u5bf9 Unicode \u7f16\u7801\u8fdb\u2f8f\u7f16\u7801\uff0c")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"\u7f16\u7a0b 1-4 \u4e2a\u53ef\u53d8\u957f\u5ea6\u7684\u5b57\u8282 10w+\u5b57\u7b26\u3002 \u53ef\u53d8\u5728 utf-8 \u4e00\u4e2a\u5b57\u6bcd\u662f\u4e00\u4e2a\u5b57\u8282 \u4e00\u4e2a\u6c49\u5b57\u662f 3 \u4e2a\u5b57\u8282"),(0,o.kt)("blockquote",{parentName:"li"},(0,o.kt)("p",{parentName:"blockquote"},"\u7ed3\u8bba\uff1aGB \u7f16\u7801\u4e2d 1 \u4e2a\u6c49\u5b57\u662f 2 \u4e2a\u5b57\u8282\uff0c\u5728 utf8 \u7f16\u7801\u4e2d\u2f00\u4e2a\u6c49\u5b57\u662f 3 \u4e2a\u5b57\u8282\uff08\u5e38\u2ec5\u7684 ASCII \u5b57\u7b26\uff0c\u4f7f\u2f64\u2f00\u4e2a\u5b57\u8282\u8868\u793a\uff09\u3002"),(0,o.kt)("p",{parentName:"blockquote"},"node \u4e2d\u9ed8\u8ba4\u4e0d\u2f40\u6301 GB \u7f16\u7801")))),(0,o.kt)("h3",{id:"4base64-\u7f16\u7801"},"4).base64 \u7f16\u7801"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u4e3a\u4ec0\u4e48\u8981\u8fdb\u884c\u7f16\u7801")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"base64 \u7f16\u7801 \uff08\u7f16\u7801\u683c\u5f0f\uff09 \u660e\u6587\uff0c\u6309\u7167\u5927\u5bb6\u90fd\u77e5\u9053\u7684\u89c4\u5219\u8fdb\u884c\u7684\u8f6c\u5316 ",(0,o.kt)("inlineCode",{parentName:"p"},"base32")),(0,o.kt)("p",{parentName:"blockquote"},"http \u6587\u672c\u683c\u5f0f\u7684\u534f\u8bae \u5c06\u4e8c\u8fdb\u5236\u8fdb\u884c\u7f16\u7801\u4f20\u8f93 -\u300b\u5b57\u7b26\u4e32")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u5c06 1 \u4e2a\u6587\u5b57 3 ","*"," 8 \u4e2a\u4f4d = 24 \u4f4d")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'console.log(Buffer.from("\u5e05")) // e5 b8 85\n// 16\u8fdb\u5236\u8f6c2\u8fdb\u5236\nconsole.log((0xe5).toString(2))\nconsole.log((0xb8).toString(2))\nconsole.log((0x85).toString(2))\n\n// 11100101 10111000 10000101\n// // 111001 011011 100010 000101 3 * 8 = 4 *6\n// 2 \u8fdb\u5236\u8f6c\u6362\u4e3a10 \u8fdb\u5236\nconsole.log(parseInt("00111001", 2)) //57\nconsole.log(parseInt("00011011", 2)) //27\nconsole.log(parseInt("00100010", 2)) // 34\nconsole.log(parseInt("00000101", 2)) //5\n\n// \u4e2d\u2f42\u7f16\u7801\u53d6\u503c\u8868 64\u4e2a\nlet code = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"\ncode += code.toLowerCase()\ncode += "0123456789"\ncode += "+/"\n\nconsole.log(code[57] + code[27] + code[34] + code[5]) //5biF\n// \u7f3a\u70b9 3\u4e2a\u5b57\u8282\u53d8\u4e3a4\u4e2a\u5b57\u8282  3\u4e2a -\u300b 4\u4e2a  1M -\u300b 1.3M\n\nconsole.log(Buffer.from("\u5e05").toString("base64")) // 5biF\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"base64 \u7684\u4f18\u7f3a\u70b9\uff1aBase64 \u662f\u5c06\u2f06\u8fdb\u5236\u8f6c\u6362\u6210\u2f42\u672c\u5b57\u7b26\u4e32\uff0c\u2f45\u4fbf\u4f20\u8f93\u3002\u7f3a\u70b9\u5c31\u662f\u8f6c\u6362\u6210 base64 \u7f16\u7801\u7684\u7ed3\u679c\u2f50\u4ee5\u524d\u2f24 1/3\u3002")),(0,o.kt)("h2",{id:"5--buffer-\u7684\u4f7f"},(0,o.kt)("strong",{parentName:"h2"},"5 . Buffer \u7684\u4f7f\u2f64")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"buffer \u4ee3\u8868\u7684\u662f\u5185\u5b58\u4e2d\u5b58\u7684\u4e8c\u8fdb\u5236\u6570\u636e \uff08buffer \u4e2d\u5b58\u653e\u7684\u90fd\u662f\u5f15\u7528\u7c7b\u578b\uff09")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"buffer \u4e00\u4f46\u58f0\u660e\u4e86\u5927\u5c0f\u4e4b\u540e \u4e0d\u80fd\u66f4\u6539\u58f0\u660e\u7684\u5927\u5c0f"))),(0,o.kt)("h3",{id:"1buffer-\u7684\u58f0\u660e\u5f0f"},"1).buffer \u7684\u58f0\u660e\u2f45\u5f0f"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"buffer \u7684\u58f0\u660e\u65b9\u5f0f 3 \u79cd"),(0,o.kt)("ol",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ol"},"\u901a\u8fc7\u957f\u5ea6\u6765\u58f0\u660e")),(0,o.kt)("p",{parentName:"blockquote"},"2) \u901a\u8fc7\u6570\u7ec4\u65b9\u5f0f\u6765\u58f0\u660e\uff08\u57fa\u672c\u4e0d\u7528\uff09\n3) \u901a\u8fc7\u5b57\u7b26\u4e32\u6765\u58f0\u660e new Buffer")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const buf1 = Buffer.alloc(3) // // \u6839\u636e\u2ed3\u5ea6\u6765\u58f0\u660ebuffer \u5728\u5f00\u53d1\u4e2d\u90fd\u662f\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u7684, \u5c55\u73b0\u5f62\u5f0f\u662f16\u8fdb\u5236\nconsole.log(buf1) // <Buffer 00 00 00>\n\nconst buf2 = Buffer.from([0x10, 0x20, 0x30]) // \u901a\u8fc7\u6307\u5b9a\u5b58\u50a8\u5185\u5bb9\u6765\u58f0\u660e\nconsole.log(buf2) //<Buffer 10 20 30>\n\nconst buf3 = Buffer.from("\u4f60\u597d") // \u901a\u8fc7\u5b57\u7b26\u4e32\u6765\u58f0\u660ebuffer\nconsole.log(buf3) //<Buffer e4 bd a0 e5 a5 bd>\n')),(0,o.kt)("h3",{id:"2buffercopy"},(0,o.kt)("strong",{parentName:"h3"},"2).buffer.copy")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"buffer \u7684\u6269\u5bb9\u95ee\u9898 http \u8bf7\u6c42\u4f20\u8f93\u4e8c\u8fdb\u5236\u7684\u65f6\u5019 \u5c31\u662f\u4e00\u6bb5\u6bb5")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const buf1 = Buffer.from("\u4f60\u597d")\nconst buf2 = Buffer.from("\u4e16\u754c")\n// buffer \u53ef\u4ee5\u901a\u8fc7\u957f\u5ea6(\u5b57\u8282\u957f\u5ea6)\u548c\u7d22\u5f15\u6765\u8bbf\u95ee\n\n// \uff08\u7ecf\u5e38\u4f1a\u5c06\u591a\u4e2abuffer\u62fc\u63a5\u6210\u4e00\u4e2abuffer\uff09\n// 1) \u65ad\u70b9\u7eed\u4f20\uff0c \u5206\u7247\u4e0a\u4f20  -\u300b \u5927\u6bb5\n// 2) http\u8bf7\u6c42\u4e5f\u662f\u5206\u6bb5\u4f20\u8f93\u7684\nconst big = Buffer.alloc(buf1.length + buf2.length)\n\nbuf1.copy(big, 0)\nbuf2.copy(big, buf1.length)\nconsole.log("big=>", big) //big=> <Buffer e4 bd a0 e5 a5 bd e4 b8 96 e7 95 8c>\nconsole.log(big.toString()) // \u4f60\u597d\u4e16\u754c\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u6a21\u62df\u5b9e\u73b0")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Buffer.prototype.copy = function (\n  target,\n  targetStart,\n  sourceStart = 0,\n  sourceEnd = this.length\n) {\n  for (let i = 0; i < sourceEnd - sourceStart; i++) {\n    target[targetStart + i] = this[sourceStart + i] // // buffer\u4e2d\u5b58\u653e\u7684\u90fd\u662f\u5f15\u2f64\u7c7b\u578b\n  }\n}\n")),(0,o.kt)("h3",{id:"3bufferconcat"},(0,o.kt)("strong",{parentName:"h3"},"3).Buffer.concat")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const buf1 = Buffer.from("\u4f60\u597d")\nconst buf2 = Buffer.from("\u4e16\u754c")\nconsole.log(Buffer.concat([buf1, buf2], 12))\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u6a21\u62df\u5b9e\u73b0")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Buffer.concat = function (\n  bufList,\n  total = bufList.reduce((acc, cur) => acc + cur.length, 0)\n) {\n  // \u5185\u90e8\u9700\u8981\u521b\u5efabuffer\n  const buf = Buffer.alloc(total)\n  let offset = 0\n  for (let i = 0; i < bufList.length; i++) {\n    const cur = bufList[i]\n    cur.copy(buf, offset)\n    offset += cur.length\n  }\n  // \u6211\u4eec\u53ef\u4ee5\u5c06\u4e0d\u9700\u8981\u7684\u90e8\u5206\u7ed9\u5220\u9664\u6389\uff0c\u5c31\u662f\u6570\u7ec4\u7684slice\n  return buf.slice(0, offset)\n}\n")),(0,o.kt)("h3",{id:"4buffersplit"},(0,o.kt)("strong",{parentName:"h3"},"4).buffer.split")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"slice \u65b9\u6cd5\u8981\u614e\u91cd \u622a\u53d6\u67d0\u4e00\u6bb5 , \u5bf9\u4e8e buffer \u800c\u8a00\u6d45\u62f7\u8d1d")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const buf = Buffer.alloc(6)\nconsole.log("buf", buf) //buf <Buffer 00 00 00 00 00 00>\nconst c = buf.slice(0, 1)\nc[0] = 100\nconsole.log("buf", buf) //buf <Buffer 64 00 00 00 00 00>\n')),(0,o.kt)("p",null,"\u5982\u679c\u60f3\u751f\u6210\u4e00\u4e2a\u65b0\u7684 buffer \u548c\u539f\u6765\u7684\u5185\u5bb9\u4e00\u6837 \u5e94\u8be5\u91c7\u7528\u7684\u662f\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 buffer\uff0c\u628a\u5185\u5bb9\u7c98\u8d34\u8fdb\u53bb\uff0c\u800c\u4e0d\u662f\u91c7\u7528 slice"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u5e38\u7528\u7684 buffer \u65b9\u6cd5")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},".length")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},".concat")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"isBuffer")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},".slice")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},".split \u81ea\u5df1\u7684"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u884c\u8bfb\u53d6\u5668"),"\uff0c \u6bcf\u6b21\u8bfb\u53d6\u5185\u5bb9\u7684\u4e00\u884c\u3002 \u6570\u636e\u4f20\u8f93 formdata"),(0,o.kt)("p",null,"test.txt"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"abc\ndeg\nghx\n")),(0,o.kt)("p",null,"main.js"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Buffer.prototype.split = function (sep) {\n  // \u5728node\u4e2d\u5904\u7406\u6570\u636e\u7684\u65f6\u5019 \u8981\u4fdd\u8bc1\u6570\u636e\u683c\u5f0f\u662f\u7edf\u4e00\u7684\n  const arr = []\n  const sepLen = Buffer.isBuffer(sep) ? sep.length : Buffer.from(sep).length\n  let offset = 0\n  let cur = 0\n  while (-1 !== (cur = this.indexOf(sep, offset))) {\n    arr.push(this.slice(offset, cur))\n    offset = cur + sepLen // \u4ece\u5f53\u524d\u7684\u622a\u53d6\u7684\u4e0b\u4e00\u4e2a\u5206\u5272\u7b26\u53f7\u7684\u4f4d\u7f6e\u4e3a\u5f00\u5934\u7ee7\u7eed\u67e5\u627e\n  }\n  console.log(offset)\n  arr.push(this.slice(offset)) // \u6700\u540e\u4e00\u6bb5\u4e5f\u8981\u653e\u8fdb\u6765\n  return arr\n}\nlet arr = r.split(\"\\r\\n\")\nfor (let i = 0; i < arr.length; i++) {\n  arr[i] = arr[i].toString()\n}\nconsole.log(arr) //[ 'abc', 'deg', 'ghx', '' ]\n")),(0,o.kt)("h2",{id:"6path-\u6a21\u5757"},"6.path \u6a21\u5757"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const { resolve, join, dirname, extname, basename } = require("path")\n// resolve \u7279\u70b9\uff1a\u8fd4\u56de\u7edd\u5bf9\u8def\u5f84\uff0c\u4f46\u662f\u5982\u679c\u4f60\u4f20\u9012\u662f\u4e00\u4e2a\u76f8\u5bf9\u8def\u5f84\uff0c\u4f1a\u6839\u636e\u7528\u6237\u6267\u884c\u7684\u4f4d\u7f6e\u6765\u8f6c\u6362\u6210\u7edd\u5bf9\u8def\u5f84 process.cwd()\n\nconsole.log(resolve(__dirname, "./test.txt"))\nconsole.log(resolve("./test.txt")) // console.log(resolve(process.cwd(),\'./test.txt\'))\n// __dirname \u662fnode\u4e2dcommonjs\u5b9e\u73b0\u7684\u65f6\u5019 \u7ed9\u51fd\u6570\u6dfb\u52a0\u7684\u53c2\u6570\uff0c\u5728node\u73af\u5883\u4e0b\u5982\u679c\u4f60\u8981\u662f\u4f7f\u7528\u4e86commonjs\n// \u6b63\u5e38\u60c5\u51b5\u4e0b join\u548cresolve\u80fd\u7528\u4e0d\u540c\u7684\u5199\u6cd5\u8fbe\u5230\u540c\u6837\u7684\u76ee\u7684\uff0c\u4f46\u662f\u5982\u679c\u6709/\u7684\u60c5\u51b5\uff0c\u8981\u62fc\u63a5\u53ea\u80fd\u91c7\u7528join\u65b9\u6cd5\nconsole.log(resolve(__dirname, "./test.txt", "/")) //  /\nconsole.log(join(process.cwd(), "a", "b", "c", "../")) // \u4e0d\u4f1a\u4ea7\u751f\u7edd\u5bf9\u8def\u5f84\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'console.log(dirname("a/b/c/")) // a/b\nconsole.log(extname("a.js")) //.js\nconsole.log(basename("a.js", "s")) // a.j\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5728 mjs \u4e2d\u5904\u7406\u8def\u5f84\u7684\u6ce8\u610f\u70b9\uff0cmjs \u4e2d\u6ca1\u6709",(0,o.kt)("strong",{parentName:"p"},"dirname,"),"filename\u3002\u9700\u8981\u901a\u8fc7 import.meta.url \u4e2d\u6765\u83b7\u53d6\u5f53\u524d\u2f42\u4ef6\u8def\u5f84\u3002\uff08mjs \u539f\u7406\uff1anode \u4e2d\u8fdb\u2f8f\u52a0\u8f7d\u65f6\u4f1a\u521b\u5efa\u2f00\u4e2a\u65b0\u7684\u4f5c\u2f64\u57df\uff0c\u5728\u5185\u90e8\u8fd0\u2f8f\u6a21\u5757\u4ee3\u7801\uff09")),(0,o.kt)("p",null,"01.mjs"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import path from \"path\" // mjs -> esModule \u5728node\u4e2d\u662f\u81ea\u5df1\u5b9e\u73b0\u7684\u6a21\u5757\u52a0\u8f7d\u5668\uff0c\u672c\u8d28\u4e0a\u5c31\u662f\u7ed9\u6bcf\u4e2a\u6a21\u5757\u589e\u52a0\u4e86\u7acb\u5373\u6267\u884c\u51fd\u6570\n//import url from 'url'; // url\u91cc\u7684parse\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u89e3\u6790\n// const obj = url.parse(import.meta.url)\nconst obj = new URL(import.meta.url) // \u5c31\u662f\u5c06\u8def\u5f84\u8f6c\u6362\u6210\u5bf9\u8c61\uff0c\u53d6\u4ed6\u7684\u6838\u5fc3path\nlet dirname = path.dirname(obj.pathname)\nconsole.log(dirname, obj.pathname)\n")),(0,o.kt)("h2",{id:"7events-\u6a21\u5757"},"7.events \u6a21\u5757"),(0,o.kt)("p",null,"node \u4e2d\u63d0\u4f9b\u7684\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f \u5b9e\u73b0\u5f02\u6b65\u5904\u7406\u3002 \u89e3\u8026\u5408"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5982\u4f55\u7ee7\u627f\u539f\u578b\u4e0a\u7684\u65b9\u6cd5")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Object.create()")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Object.setPrototypeof")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Girl.prototype.",(0,o.kt)("strong",{parentName:"p"},"proto")," = EventEmiter.prototype")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Girl extends EventEmitter\\"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u624b\u52a8\u89e6\u53d1")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const EventEmitter = require("events")\nfunction Girl() {}\nObject.setPrototypeOf(Girl.prototype, EventEmitter.prototype)\nlet girl = new Girl()\ngirl.on("\u2f25\u2f63\u5931\u604b\u4e86", () => {\n  console.log("\u72c2\u5403")\n})\ngirl.on("\u2f25\u2f63\u5931\u604b\u4e86", () => {\n  console.log("\u901b\u8857")\n})\ngirl.on("\u2f25\u2f63\u5931\u604b\u4e86", () => {\n  console.log("\u54ed\u54ed\u54ed")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u901b\u8857")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u5403\u996d")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u54ed")\n})\ngirl.on("\u7761\u89c9", function () {\n  console.log("\u4e0d\u54ed")\n})\ngirl.emit("\u5931\u604b")\ngirl.emit("\u5931\u604b")\n\ngirl.emit("\u7761\u89c9")\n// \u901b\u8857 \u5403\u996d \u54ed \u901b\u8857 \u5403\u996d \u54ed \u4e0d\u54ed\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u81ea\u52a8\u89e6\u53d1")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const EventEmitter = require("events")\nfunction Girl() {}\nObject.setPrototypeOf(Girl.prototype, EventEmitter.prototype)\nlet girl = new Girl()\ngirl.on("\u2f25\u2f63\u5931\u604b\u4e86", () => {\n  console.log("\u72c2\u5403")\n})\ngirl.on("\u2f25\u2f63\u5931\u604b\u4e86", () => {\n  console.log("\u901b\u8857")\n})\ngirl.on("\u2f25\u2f63\u5931\u604b\u4e86", () => {\n  console.log("\u54ed\u54ed\u54ed")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u901b\u8857")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u5403\u996d")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u54ed")\n})\ngirl.on("\u7761\u89c9", function () {\n  console.log("\u4e0d\u54ed")\n})\n// \u901b\u8857 \u5403\u996d \u54ed \u901b\u8857 \u5403\u996d \u54ed \u4e0d\u54ed\n')),(0,o.kt)("p",null,"\u81ea\u52a8\u89e6\u53d1"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'process.nextTick(() => {\n  girl.emit("\u5931\u604b")\n})\nprocess.nextTick(() => {\n  girl.emit("\u7761\u89c9")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u901b\u8857")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u5403\u996d")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u54ed")\n})\ngirl.on("\u7761\u89c9", function () {\n  console.log("\u4e0d\u54ed")\n})\n//\u901b\u8857 \u5403\u996d \u54ed \u4e0d\u54ed\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"newListener \u4e8b\u4ef6")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'girl.on("newListener", function (type) {\n  console.log(type, "\uff0c\u6bcf\u6b21\u90fd\u89e6\u53d1") //\u6bcf\u6b21\u7ed1\u5b9a\u4e8b\u4ef6\u90fd\u4f1a\u89e6\u53d1\u6b64\u65b9\u6cd5\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u901b\u8857")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u5403\u996d")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u54ed")\n})\ngirl.on("\u7761\u89c9", function () {\n  console.log("\u4e0d\u54ed")\n})\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u5f02\u6b65\u7ed1\u5b9a")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'girl.on("newListener", function (type) {\n  //\u6bcf\u6b21\u7ed1\u5b9a\u4e8b\u4ef6\u90fd\u4f1a\u89e6\u53d1\u6b64\u65b9\u6cd5\n  process.nextTick(() => {\n    girl.emit(type)\n  })\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u901b\u8857")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u5403\u996d")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u54ed")\n})\ngirl.on("\u7761\u89c9", function () {\n  console.log("\u4e0d\u54ed")\n})\n// \u901b\u8857\u5403\u996d\u54ed\u901b\u8857\u5403\u996d\u54ed\u901b\u8857\u5403\u996d\u54ed\u4e0d\u54ed\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u540c\u6b65\u7ed1\u5b9a")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'girl.on("newListener", function (type) {\n  //\u6bcf\u6b21\u7ed1\u5b9a\u4e8b\u4ef6\u90fd\u4f1a\u89e6\u53d1\u6b64\u65b9\u6cd5\n  console.log("start=>")\n  girl.emit(type)\n  console.log("end=>")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u901b\u8857")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u5403\u996d")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u54ed")\n})\ngirl.on("\u7761\u89c9", function () {\n  console.log("\u4e0d\u54ed")\n})\n//start=>\n//end=>\n//start=>\n//\u901b\u8857\n//end=>\n//start=>\n//\u901b\u8857\n//\u5403\u996d\n//end=>\n//start=>\n//end=>\n')),(0,o.kt)("p",null,"\u6279\u5904\u7406"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'let set = new Set() // eventName\ngirl.on("newListener", (eventName) => {\n  // \u6bcf\u6b21\u7ed1\u5b9a\u65b0\u4e8b\u4ef6 \u5c31\u4f1a\u89e6\u53d1\u6b64\u65b9\u6cd5\n  if (!set.has(eventName)) {\n    set.add(eventName)\n    process.nextTick(() => {\n      // \u591a\u6b21\u88ab\u5408\u5e76\u6210\u4e00\u6b21\n      set.delete(eventName)\n      girl.emit(eventName) // \u4e3b\u52a8\u89e6\u53d1\u7684\u6a21\u5f0f\uff0c\u6211\u9700\u8981\u81ea\u5df1\u6765\u89e6\u53d1\u5bf9\u5e94\u7684\u4e8b\u4ef6\u3002 \u5982\u679c\u7528\u6237\u7ed1\u5b9a\u4e86\u6b64\u4e8b\u4ef6\u5c31\u53ef\u4ee5\u76f4\u63a5\u89e6\u53d1\n    })\n  }\n})\n// \u5931\u604b [fn,fn,fn]\n// \u7761\u89c9 [fn]\ngirl.on("\u5931\u604b", function () {\n  console.log("\u901b\u8857")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u5403\u996d")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u54ed")\n})\ngirl.on("\u5931\u604b", function () {\n  console.log("\u54ed")\n})\n')),(0,o.kt)("h3",{id:"\u53d1\u5e03\u8ba2\u9605"},"\u53d1\u5e03\u8ba2\u9605"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'function EventEmitter() {\n  this._events = {}\n}\nEventEmitter.prototype.on = function (eventName, fn) {\n  if (!this._events) this._events = {}\n  if (eventName !== "newListener") {\n    this.emit("newListener", eventName)\n  }\n  ;(this._events[eventName] || (this._events[eventName] = [])).push(fn)\n}\n\nEventEmitter.prototype.emit = function (eventName, ...args) {\n  if (!this._events) this._events = {}\n  let eventLists = this._events[eventName]\n  if (eventLists) eventLists.forEach((fn) => fn(...args))\n}\nEventEmitter.prototype.off = function (eventName, fn) {\n  if (!this._events) this._events = {}\n  let eventLists = this._events[eventName]\n  if (eventLists) {\n    this._events[eventName] = eventLists.filter((item) => item != fn)\n  }\n}\nEventEmitter.prototype.once = function (eventName, fn) {\n  if (!this._events) this._events = {}\n  const once = (...args) => {\n    fn.call(this, ...args)\n    this.off(eventName, once) // \u89e6\u53d1once\u51fd\u6570\u540e\u5c06once\u79fb\u9664\u6389\n  }\n  once.l = fn\n  this.on(eventName, once)\n}\n')),(0,o.kt)("h2",{id:"8fs\u6a21\u5757"},(0,o.kt)("strong",{parentName:"h2"},"8"),".fs",(0,o.kt)("strong",{parentName:"h2"},"\u6a21\u5757")),(0,o.kt)("h3",{id:"1readfilewritefile"},(0,o.kt)("strong",{parentName:"h3"},"1).readFile"),"\u3001",(0,o.kt)("strong",{parentName:"h3"},"writeFile")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const fs = require("fs")\nconst path = require("path")\n// \u8bfb\u53d6\u2f42\u4ef6\u8981\u6ce8\u610f\u7684\u662f\u2f42\u4ef6\u4e0d\u5b58\u5728\u4f1a\u62a5\u9519\nfs.readFile(path.resolve(__dirname, "name.txt"), "utf8", function (err, data) {\n  // \u5199\u2f0a\u64cd\u4f5c\u9ed8\u8ba4\u4f1a\u521b\u5efa\u2f42\u4ef6\uff0c \u5982\u679c\u5199\u2f0a\u7684\u2f42\u4ef6\u6709\u5185\u5bb9\u9ed8\u8ba4\u4f1a\u6e05\u7a7a\u5728\u5199\u2f0a\n  if (err) return console.log(err)\n  fs.writeFile(path.resolve(__dirname, "copy.txt"), data, function (err) {\n    if (err) return console.log(err)\n    console.log(data)\n  })\n})\n// \u95ee\u9898\uff1a\u6570\u636e\u8fc7\u2f24, \u9700\u8981\u5168\u90e8\u8bfb\u53d6\u5230\u5185\u5b58\u4e2d\uff0c\u4f1a\u5bfc\u81f4\u6df9\u6ca1\u53ef\u2f64\u5185\u5b58\u3002\n')),(0,o.kt)("h3",{id:"2\u52a8\u8bfb\u53d6"},(0,o.kt)("strong",{parentName:"h3"},"2)."),"\u2f3f\u52a8\u8bfb\u53d6"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const buf = Buffer.alloc(3)\n// flag \u6807\u8bc6\u7b26:\n// - 'r'\uff1a\u4ee5\u8bfb\u53d6\u2f45\u5f0f\u6253\u5f00\u2f42\u4ef6\u3002\u5982\u679c\u2f42\u4ef6\u4e0d\u5b58\u5728\uff0c\u62a5\u9519\n// - 'r+'\uff1a\u4ee5\u8bfb\u5199\u2f45\u5f0f\u6253\u5f00\u2f42\u4ef6\u3002\u5982\u679c\u2f42\u4ef6\u4e0d\u5b58\u5728\uff0c\u62a5\u9519\n// - 'w'\uff1a\u4ee5\u5199\u2f0a\u2f45\u5f0f\u6253\u5f00\u2f42\u4ef6\u3002\u5982\u679c\u2f42\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u8be5\u2f42\u4ef6\u3002\u5982\u679c\u2f42\u4ef6\u5b58\u5728\uff0c\u5219\u8986\u76d6\u3002\n// - 'w+'\uff1a\u4ee5\u8bfb\u5199\u2f45\u5f0f\u6253\u5f00\u2f42\u4ef6\u3002\u5982\u679c\u2f42\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u8be5\u2f42\u4ef6\u3002\u5982\u679c\u2f42\u4ef6\u5b58\u5728\uff0c\u5219\u5c06\u5176\u8986\u76d6\u3002\n// - 'a+'\uff1a\u4ee5\u8bfb\u5199\u2f45\u5f0f\u6253\u5f00\u2f42\u4ef6\u3002\u5982\u679c\u2f42\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u8be5\u2f42\u4ef6\u3002\u5982\u679c\u2f42\u4ef6\u5b58\u5728\uff0c\u5219\u53ef\u4ee5\u8bfb\u53d6\u2f42\u4ef6\uff0c\u5e76\u5728\u2f42\u4ef6\u672b\u5c3e\u8ffd\u52a0\u6570\u636e\u3002\n// mode \u2f06\u8fdb\u5236\u7ec4\u5408: \u6743\u9650\u7684\u7ec4\u5408\uff0c\u2f64\u6237\u7684\u6267\u2f8f\u6743\u9650\uff0c\u2f64\u6237\u7684\u5199\u2f0a\u6743\u9650\uff0c\u2f64\u6237\u7684\u8bfb\u53d6\u6743\u9650 1\u76f42\u51994\u8bfb\n// 0o666 \u7684\u503c\u4ee3\u8868\u4e86\u2f64\u6237\u3001\u7ec4\u548c\u5176\u4ed6\u2f64\u6237\u90fd\u5177\u6709\u8bfb\u53d6\u548c\u5199\u2f0a\u6743\u9650\u3002\nfs.open(path.resolve(__dirname, \"name.txt\"), \"r\", function (err, fd) {\n  // fd file descriptor \u6570\u5b57\n  // \u8868\u793a\u6211\u8981\u8bfb\u53d6name.txt ,\u5c06\u5185\u5bb9\u5199\u2f0a\u5230buf\u4e2d, \u8868\u793a\u4ecebuffer\u7684\u7b2c0\u4e2a\u4f4d\u7f6e\u5199\uff0c\u5199\u2f0a3\u4e2a, \u8bfb\u53d6\u2f42\u4ef6\u7684\u4f4d\u7f6e\n  fs.read(fd, buf, 0, 3, 0, function (err, bytesRead) {\n    // \u771f\u5b9e\u8bfb\u53d6\u5230\u7684\u4e2a\u6570\n    fs.open(path.resolve(__dirname, \"copy.txt\"), \"w\", function (err, wfd) {\n      // \u6211\u5e0c\u671b\u5199\u2f0a\u5185\u5bb9\uff0c\u90a3\u4e48\u9700\u8981\u8bfb\u53d6buffer\u4ece\u7b2c0\u4e2a\u4f4d\u7f6e\u8bfb\u53d6\u8bfb\u5230\u7684\u4e2a\u6570,\u5199\u2f0a\u5230\u2f42\u4ef6\u7684\u7b2c0\u4e2a\u4f4d\u7f6e\n      fs.write(wfd, buf, 0, bytesRead, 0, function (err, written) {\n        console.log(written)\n      })\n    })\n  })\n})\n")),(0,o.kt)("h3",{id:"3\u9012\u5f52\u62f7"},(0,o.kt)("strong",{parentName:"h3"},"3)."),"\u9012\u5f52\u62f7\u2ec9"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'function copy(source, target, cb) {\n  let readPosition = 0\n  let position = 0\n  function destroy(fd, wfd) {\n    let times = 0\n    function done() {\n      if (++times === 2) {\n        cb()\n      }\n    }\n    fs.close(fd, done)\n    fs.close(wfd, done)\n  }\n  fs.open(source, "r", function (err, fd) {\n    if (err) return cb(err)\n    fs.open(target, "w", function (err, wfd) {\n      if (err) return cb(err)\n      function next() {\n        fs.read(fd, buf, 0, 3, readPosition, function (err, bytesRead) {\n          if (err) return cb(err)\n          readPosition += bytesRead\n          fs.write(wfd, buf, 0, bytesRead, position, function (err, written) {\n            if (err) return cb(err)\n            position += written\n            if (bytesRead < 3) return destroy(fd, wfd) // \u8bfb\u53d6\u4e0d\u5230\u5185\u5bb9\u5c31\u5173\u95ed\n            next()\n          })\n        })\n      }\n      next() // \u5f02\u6b65\u8fed\u4ee3\u53ef\u4ee5\u901a\u8fc7\u9012\u5f52\u51fd\u6570\u6765\u5b9e\u73b0\n    })\n  })\n}\n')),(0,o.kt)("h3",{id:"4\u4ef6\u6d41\u5b9e\u73b0\u62f7"},(0,o.kt)("strong",{parentName:"h3"},"4)."),"\u2f42\u4ef6\u6d41\u5b9e\u73b0\u62f7\u2ec9"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'function copy(source, target, cb) {\n  let rs = fs.createReadStream(source, {\n    highWaterMark: 4,\n  })\n  let ws = fs.createWriteStream(target, {\n    highWaterMark: 1,\n  })\n  rs.on("data", function (chunk) {\n    let flag = ws.write(chunk)\n    if (!flag) {\n      rs.pause()\n    }\n  })\n  ws.on("drain", function () {\n    console.log("drain")\n    rs.resume()\n  })\n}\ncopy(\n  path.resolve(__dirname, "name.txt"),\n  path.resolve(__dirname, "copy.txt"),\n  function (err) {\n    console.log("cp ok")\n  }\n)\n')),(0,o.kt)("h3",{id:"5\u53ef\u8bfb\u6d41"},(0,o.kt)("strong",{parentName:"h3"},"5)"),".",(0,o.kt)("strong",{parentName:"h3"},"\u53ef\u8bfb\u6d41")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'let rs = fs.createReadStream(path.resolve(__dirname, "name.txt"), {\n  flags: "r", // fs.open(path,flags)\n  highWaterMark: 3, // \u6bcf\u6b21\u8bfb\u53d6\u7684\u4e2a\u6570\uff0c\u5982\u679c\u4e0d\u5199\u9ed8\u8ba4\u662f64k\n  start: 0, // start \u548cend \u51b3\u5b9a\u8bfb\u53d6\u2f0f\u4e2a\u5b57\u8282\n  end: 4,\n  autoClose: true, // \u9700\u8981\u8bfb\u53d6\u5b8c\u6bd5\u540e\u5173\u95ed\n  emitClose: true, // \u5e95\u5c42\u4f1a\u89e6\u53d1\u2f00\u4e2aclose\u4e8b\u4ef6\uff0c\u6765\u901a\u77e5\u6211\n  mode: 0o666, // \u6211\u4eec\u7684\u64cd\u4f5c\u6743\u9650\n})\nrs.on("open", function (fd) {\n  console.log("open", fd)\n})\nlet arr = []\nrs.on("data", function (chunk) {\n  rs.pause() // \u6682\u505c\u540e\u5c31\u4e0d\u4f1a\u518d\u6b21\u89e6\u53d1data\u4e8b\u4ef6\uff0c\u53ef\u4ee5\u6d88\u8d39\u8bfb\u53d6\u5230\u7684\u5185\u5bb9\uff0c\u6d88\u8d39\u540e\u518d\u53bb\u8bfb\u53d6\n  arr.push(chunk) // \u2f00\u822c\u60c5\u51b5\u4e0b\uff0c\u5ba2\u6237\u7aef\u7ed9\u6211\u4f20\u9012\u4e86\u2f00\u4e2a\u56fe\u2f5a\uff0c\u5c06\u56fe\u2f5a\u62fc\u63a5\u597d\u5199\u2f0a\u5230\u2f42\u4ef6\u4e2d\n})\nrs.on("end", function () {\n  console.log(Buffer.concat(arr))\n})\nrs.on("close", function () {\n  console.log("close")\n})\nrs.on("error", function (err) {\n  console.log(err)\n})\nsetInterval(() => {\n  rs.resume() // \u6062\u590d\u6d41\u52a8\u6a21\u5f0f\n}, 1000)\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u5b9e\u73b0\u539f\u7406")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const EventEmitter = require("events")\nconst fs = require("fs")\nclass ReadStream extends EventEmitter {\n  constructor(path, options) {\n    super()\n    this.path = path\n    this.flags = options.flags || "r"\n    this.highWaterMark = options.highWaterMark || 64 * 1024\n    this.start = options.start || 0\n    this.end = options.end || undefined\n    this.autoClose = !!options.autoClose\n    this.emitClose = !!options.emitClose\n    this.flowing = false // \u9ed8\u8ba4\u53eb\u2fae\u6d41\u52a8\u6a21\u5f0f\n    this.open() // \u9ed8\u8ba4\u6253\u5f00\u2f42\u4ef6 //1s\n    this.on("newListener", (type) => {\n      if (type === "data") {\n        this.flowing = true\n        this.read()\n      }\n    })\n    this.offset = 0\n  }\n  destroy(err) {\n    if (this.fd) {\n      fs.close(this.fd, () => {\n        if (this.emitClose) {\n          this.emit("close")\n        }\n      })\n    }\n    if (err) {\n      this.emit("error", err)\n    }\n  }\n  pause() {\n    this.flowing = false\n  }\n  resume() {\n    // \u8fd9\u2fa5\u53ef\u4ee5\u6062\u590d\u8bfb\u53d6\n    if (!this.flowing) {\n      this.flowing = true\n      this.read()\n    }\n  }\n  read() {\n    if (typeof this.fd !== "number") {\n      return this.once("open", this.read)\n    }\n    const howMutchToRead = this.end\n      ? Math.min(this.end - this.offset + 1, this.highWaterMark)\n      : this.highWaterMark\n    let buffer = Buffer.alloc(howMutchToRead)\n    fs.read(\n      this.fd,\n      buffer,\n      0,\n      howMutchToRead,\n      this.offset,\n      (err, bytesRead) => {\n        if (bytesRead) {\n          this.offset += bytesRead\n          this.emit("data", buffer.slice(0, bytesRead))\n          if (this.flowing) {\n            this.read()\n          }\n        } else {\n          this.emit("end")\n          this.destroy()\n        }\n      }\n    )\n  }\n  open() {\n    fs.open(this.path, this.flags, (err, fd) => {\n      if (err) {\n        return this.destroy(err)\n      }\n      this.fd = fd\n      this.emit("open", fd)\n    })\n  }\n}\nfunction createReadStream(path, options) {\n  return new ReadStream(path, options)\n}\nmodule.exports = createReadStream\n')))}u.isMDXComponent=!0}}]);